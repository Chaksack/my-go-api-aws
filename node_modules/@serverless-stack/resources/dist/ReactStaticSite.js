"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ReactStaticSite = void 0;
const path = __importStar(require("path"));
const fs = __importStar(require("fs-extra"));
const StaticSite_1 = require("./StaticSite");
/////////////////////
// Construct
/////////////////////
class ReactStaticSite extends StaticSite_1.StaticSite {
    constructor(scope, id, props) {
        const { path: sitePath, environment } = props || {};
        // Validate environment
        Object.keys(environment || {}).forEach((key) => {
            if (!key.startsWith("REACT_APP_")) {
                throw new Error(`Environment variables in the "${id}" ReactStaticSite must start with "REACT_APP_".`);
            }
        });
        // generate buildCommand
        let defaultBuildCommand = "npm run build";
        if (fs.existsSync(path.join(sitePath, "yarn.lock"))) {
            defaultBuildCommand = "yarn build";
        }
        super(scope, id, Object.assign({ indexPage: "index.html", errorPage: StaticSite_1.StaticSiteErrorOptions.REDIRECT_TO_INDEX_PAGE, buildCommand: defaultBuildCommand, buildOutput: "build", fileOptions: [
                {
                    exclude: "*",
                    include: "*.html",
                    cacheControl: "max-age=0,no-cache,no-store,must-revalidate",
                },
                {
                    exclude: "*",
                    include: ["*.js", "*.css"],
                    cacheControl: "max-age=31536000,public,immutable",
                },
            ] }, props));
    }
}
exports.ReactStaticSite = ReactStaticSite;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVhY3RTdGF0aWNTaXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1JlYWN0U3RhdGljU2l0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUE2QjtBQUM3Qiw2Q0FBK0I7QUFHL0IsNkNBSXNCO0FBV3RCLHFCQUFxQjtBQUNyQixZQUFZO0FBQ1oscUJBQXFCO0FBRXJCLE1BQWEsZUFBZ0IsU0FBUSx1QkFBVTtJQUM3QyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQXNCO1FBQzlELE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxHQUFHLEtBQUssSUFBSSxFQUFFLENBQUM7UUFFcEQsdUJBQXVCO1FBQ3ZCLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQzdDLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUFFO2dCQUNqQyxNQUFNLElBQUksS0FBSyxDQUNiLGlDQUFpQyxFQUFFLGlEQUFpRCxDQUNyRixDQUFDO2FBQ0g7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILHdCQUF3QjtRQUN4QixJQUFJLG1CQUFtQixHQUFHLGVBQWUsQ0FBQztRQUMxQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUMsRUFBRTtZQUNuRCxtQkFBbUIsR0FBRyxZQUFZLENBQUM7U0FDcEM7UUFFRCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsa0JBQ2IsU0FBUyxFQUFFLFlBQVksRUFDdkIsU0FBUyxFQUFFLG1DQUFzQixDQUFDLHNCQUFzQixFQUN4RCxZQUFZLEVBQUUsbUJBQW1CLEVBQ2pDLFdBQVcsRUFBRSxPQUFPLEVBQ3BCLFdBQVcsRUFBRTtnQkFDWDtvQkFDRSxPQUFPLEVBQUUsR0FBRztvQkFDWixPQUFPLEVBQUUsUUFBUTtvQkFDakIsWUFBWSxFQUFFLDZDQUE2QztpQkFDNUQ7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLEdBQUc7b0JBQ1osT0FBTyxFQUFFLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQztvQkFDMUIsWUFBWSxFQUFFLG1DQUFtQztpQkFDbEQ7YUFDRixJQUNFLEtBQUssRUFDUixDQUFDO0lBQ0wsQ0FBQztDQUNGO0FBdkNELDBDQXVDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmcy1leHRyYVwiO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcblxuaW1wb3J0IHtcbiAgU3RhdGljU2l0ZSxcbiAgU3RhdGljU2l0ZVByb3BzLFxuICBTdGF0aWNTaXRlRXJyb3JPcHRpb25zLFxufSBmcm9tIFwiLi9TdGF0aWNTaXRlXCI7XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gSW50ZXJmYWNlc1xuLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgVGhpcyB0eXBlIGhhcyBiZWVuIHJlcGxhY2VkIGJ5IHRoZSBzdGFuZGFyZCBTdGF0aWNTaXRlUHJvcHNcbiAqL1xuZXhwb3J0IHR5cGUgUmVhY3RTdGF0aWNTaXRlUHJvcHMgPSBTdGF0aWNTaXRlUHJvcHM7XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gQ29uc3RydWN0XG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuZXhwb3J0IGNsYXNzIFJlYWN0U3RhdGljU2l0ZSBleHRlbmRzIFN0YXRpY1NpdGUge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogU3RhdGljU2l0ZVByb3BzKSB7XG4gICAgY29uc3QgeyBwYXRoOiBzaXRlUGF0aCwgZW52aXJvbm1lbnQgfSA9IHByb3BzIHx8IHt9O1xuXG4gICAgLy8gVmFsaWRhdGUgZW52aXJvbm1lbnRcbiAgICBPYmplY3Qua2V5cyhlbnZpcm9ubWVudCB8fCB7fSkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBpZiAoIWtleS5zdGFydHNXaXRoKFwiUkVBQ1RfQVBQX1wiKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYEVudmlyb25tZW50IHZhcmlhYmxlcyBpbiB0aGUgXCIke2lkfVwiIFJlYWN0U3RhdGljU2l0ZSBtdXN0IHN0YXJ0IHdpdGggXCJSRUFDVF9BUFBfXCIuYFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gZ2VuZXJhdGUgYnVpbGRDb21tYW5kXG4gICAgbGV0IGRlZmF1bHRCdWlsZENvbW1hbmQgPSBcIm5wbSBydW4gYnVpbGRcIjtcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2l0ZVBhdGgsIFwieWFybi5sb2NrXCIpKSkge1xuICAgICAgZGVmYXVsdEJ1aWxkQ29tbWFuZCA9IFwieWFybiBidWlsZFwiO1xuICAgIH1cblxuICAgIHN1cGVyKHNjb3BlLCBpZCwge1xuICAgICAgaW5kZXhQYWdlOiBcImluZGV4Lmh0bWxcIixcbiAgICAgIGVycm9yUGFnZTogU3RhdGljU2l0ZUVycm9yT3B0aW9ucy5SRURJUkVDVF9UT19JTkRFWF9QQUdFLFxuICAgICAgYnVpbGRDb21tYW5kOiBkZWZhdWx0QnVpbGRDb21tYW5kLFxuICAgICAgYnVpbGRPdXRwdXQ6IFwiYnVpbGRcIixcbiAgICAgIGZpbGVPcHRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBleGNsdWRlOiBcIipcIixcbiAgICAgICAgICBpbmNsdWRlOiBcIiouaHRtbFwiLFxuICAgICAgICAgIGNhY2hlQ29udHJvbDogXCJtYXgtYWdlPTAsbm8tY2FjaGUsbm8tc3RvcmUsbXVzdC1yZXZhbGlkYXRlXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBleGNsdWRlOiBcIipcIixcbiAgICAgICAgICBpbmNsdWRlOiBbXCIqLmpzXCIsIFwiKi5jc3NcIl0sXG4gICAgICAgICAgY2FjaGVDb250cm9sOiBcIm1heC1hZ2U9MzE1MzYwMDAscHVibGljLGltbXV0YWJsZVwiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIC4uLnByb3BzLFxuICAgIH0pO1xuICB9XG59XG4iXX0=