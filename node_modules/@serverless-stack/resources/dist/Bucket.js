"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Bucket = void 0;
const constructs_1 = require("constructs");
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const s3Notifications = __importStar(require("aws-cdk-lib/aws-s3-notifications"));
const Queue_1 = require("./Queue");
const Topic_1 = require("./Topic");
const Construct_1 = require("./Construct");
const Function_1 = require("./Function");
/////////////////////
// Construct
/////////////////////
class Bucket extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        const { s3Bucket, notifications, defaultFunctionProps } = props || {};
        this.notifications = [];
        this.permissionsAttachedForAllNotifications = [];
        this.defaultFunctionProps = defaultFunctionProps;
        ////////////////////
        // Create Bucket
        ////////////////////
        if ((0, Construct_1.isCDKConstruct)(s3Bucket)) {
            this.s3Bucket = s3Bucket;
        }
        else {
            const s3BucketProps = (s3Bucket || {});
            this.s3Bucket = new s3.Bucket(this, "Bucket", Object.assign({}, s3BucketProps));
        }
        ///////////////////////////
        // Create Notifications
        ///////////////////////////
        this.addNotifications(this, notifications || []);
    }
    get bucketArn() {
        return this.s3Bucket.bucketArn;
    }
    get bucketName() {
        return this.s3Bucket.bucketName;
    }
    get notificationFunctions() {
        return this.notifications.filter((notification) => notification instanceof Function_1.Function);
    }
    addNotifications(scope, notifications) {
        notifications.forEach((notification) => this.addNotification(scope, notification));
    }
    attachPermissions(permissions) {
        this.notifications
            .filter((notification) => notification instanceof Function_1.Function)
            .forEach((notification) => notification.attachPermissions(permissions));
        this.permissionsAttachedForAllNotifications.push(permissions);
    }
    attachPermissionsToNotification(index, permissions) {
        const notification = this.notifications[index];
        if (!(notification instanceof Function_1.Function)) {
            throw new Error(`Cannot attach permissions to the "${this.node.id}" Bucket notification because it's not a Lambda function`);
        }
        notification.attachPermissions(permissions);
    }
    getConstructMetadata() {
        return {
            type: "Bucket",
            data: {
                name: this.s3Bucket.bucketName,
                notifications: this.notifications.map((n) => (0, Construct_1.getFunctionRef)(n)),
            },
        };
    }
    addNotification(scope, notification) {
        if (notification instanceof Queue_1.Queue ||
            notification.queue) {
            notification = notification;
            this.addQueueNotification(scope, notification);
        }
        else if (notification instanceof Topic_1.Topic ||
            notification.topic) {
            notification = notification;
            this.addTopicNotification(scope, notification);
        }
        else {
            notification = notification;
            this.addFunctionNotification(scope, notification);
        }
    }
    addQueueNotification(scope, notification) {
        // Parse notification props
        let notificationProps;
        let queue;
        if (notification instanceof Queue_1.Queue) {
            notification = notification;
            queue = notification;
        }
        else {
            notification = notification;
            notificationProps = notification.notificationProps;
            queue = notification.queue;
        }
        this.notifications.push(queue);
        // Create Notifications
        const events = (notificationProps === null || notificationProps === void 0 ? void 0 : notificationProps.events) || [
            s3.EventType.OBJECT_CREATED,
            s3.EventType.OBJECT_REMOVED,
        ];
        const filters = (notificationProps === null || notificationProps === void 0 ? void 0 : notificationProps.filters) || [];
        events.forEach((event) => this.s3Bucket.addEventNotification(event, new s3Notifications.SqsDestination(queue.sqsQueue), ...filters));
    }
    addTopicNotification(scope, notification) {
        // Parse notification props
        let notificationProps;
        let topic;
        if (notification instanceof Topic_1.Topic) {
            notification = notification;
            topic = notification;
        }
        else {
            notification = notification;
            notificationProps = notification.notificationProps;
            topic = notification.topic;
        }
        this.notifications.push(topic);
        // Create Notifications
        const events = (notificationProps === null || notificationProps === void 0 ? void 0 : notificationProps.events) || [
            s3.EventType.OBJECT_CREATED,
            s3.EventType.OBJECT_REMOVED,
        ];
        const filters = (notificationProps === null || notificationProps === void 0 ? void 0 : notificationProps.filters) || [];
        events.forEach((event) => this.s3Bucket.addEventNotification(event, new s3Notifications.SnsDestination(topic.snsTopic), ...filters));
    }
    addFunctionNotification(scope, notification) {
        // parse notification
        let notificationFunction, notificationProps;
        if (notification.function) {
            notification = notification;
            notificationFunction = notification.function;
            notificationProps = notification.notificationProps;
        }
        else {
            notificationFunction = notification;
        }
        // create function
        const i = this.notifications.length;
        const fn = Function_1.Function.fromDefinition(scope, `Notification_${this.node.id}_${i}`, notificationFunction, this.defaultFunctionProps, `The "defaultFunctionProps" cannot be applied if an instance of a Function construct is passed in. Make sure to define all the consumers using FunctionProps, so the Table construct can apply the "defaultFunctionProps" to them.`);
        this.notifications.push(fn);
        // create Notifications
        const events = (notificationProps === null || notificationProps === void 0 ? void 0 : notificationProps.events) || [
            s3.EventType.OBJECT_CREATED,
            s3.EventType.OBJECT_REMOVED,
        ];
        const filters = (notificationProps === null || notificationProps === void 0 ? void 0 : notificationProps.filters) || [];
        events.forEach((event) => this.s3Bucket.addEventNotification(event, new s3Notifications.LambdaDestination(fn), ...filters));
        // attached permissions
        this.permissionsAttachedForAllNotifications.forEach((permissions) => fn.attachPermissions(permissions));
    }
}
exports.Bucket = Bucket;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnVja2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0J1Y2tldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUF1QztBQUN2Qyx1REFBeUM7QUFDekMsa0ZBQW9FO0FBQ3BFLG1DQUFnQztBQUNoQyxtQ0FBZ0M7QUFDaEMsMkNBQTJFO0FBQzNFLHlDQUErRTtBQXdDL0UscUJBQXFCO0FBQ3JCLFlBQVk7QUFDWixxQkFBcUI7QUFFckIsTUFBYSxNQUFPLFNBQVEsc0JBQVM7SUFNbkMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFtQjtRQUMzRCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLE1BQU0sRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLG9CQUFvQixFQUFFLEdBQUcsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUN0RSxJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsc0NBQXNDLEdBQUcsRUFBRSxDQUFDO1FBQ2pELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxvQkFBb0IsQ0FBQztRQUVqRCxvQkFBb0I7UUFDcEIsZ0JBQWdCO1FBQ2hCLG9CQUFvQjtRQUVwQixJQUFJLElBQUEsMEJBQWMsRUFBQyxRQUFRLENBQUMsRUFBRTtZQUM1QixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQXFCLENBQUM7U0FDdkM7YUFBTTtZQUNMLE1BQU0sYUFBYSxHQUFHLENBQUMsUUFBUSxJQUFJLEVBQUUsQ0FBbUIsQ0FBQztZQUN6RCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxvQkFDdkMsYUFBYSxFQUNoQixDQUFDO1NBQ0o7UUFFRCwyQkFBMkI7UUFDM0IsdUJBQXVCO1FBQ3ZCLDJCQUEyQjtRQUUzQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLGFB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QyxvQkFBb0IsRUFDekIsbU9BQW1PLENBQ3BPLENBQUM7UUFDRixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU1Qix1QkFBdUI7UUFDdkIsTUFBTSxNQUFNLEdBQUcsQ0FBQSxpQkFBaUIsYUFBakIsaUJBQWlCLHVCQUFqQixpQkFBaUIsQ0FBRSxNQUFNLEtBQUk7WUFDMUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxjQUFjO1lBQzNCLEVBQUUsQ0FBQyxTQUFTLENBQUMsY0FBYztTQUM1QixDQUFDO1FBQ0YsTUFBTSxPQUFPLEdBQUcsQ0FBQSxpQkFBaUIsYUFBakIsaUJBQWlCLHVCQUFqQixpQkFBaUIsQ0FBRSxPQUFPLEtBQUksRUFBRSxDQUFDO1FBQ2pELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUN2QixJQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUNoQyxLQUFLLEVBQ0wsSUFBSSxlQUFlLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLEVBQ3pDLEdBQUcsT0FBTyxDQUNYLENBQ0YsQ0FBQztRQUVGLHVCQUF1QjtRQUN2QixJQUFJLENBQUMsc0NBQXNDLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FDbEUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUNsQyxDQUFDO0lBQ0osQ0FBQztDQUNGO0FBeE9ELHdCQXdPQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgKiBhcyBzMyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLXMzXCI7XG5pbXBvcnQgKiBhcyBzM05vdGlmaWNhdGlvbnMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1zMy1ub3RpZmljYXRpb25zXCI7XG5pbXBvcnQgeyBRdWV1ZSB9IGZyb20gXCIuL1F1ZXVlXCI7XG5pbXBvcnQgeyBUb3BpYyB9IGZyb20gXCIuL1RvcGljXCI7XG5pbXBvcnQgeyBnZXRGdW5jdGlvblJlZiwgU1NUQ29uc3RydWN0LCBpc0NES0NvbnN0cnVjdCB9IGZyb20gXCIuL0NvbnN0cnVjdFwiO1xuaW1wb3J0IHsgRnVuY3Rpb24gYXMgRm4sIEZ1bmN0aW9uUHJvcHMsIEZ1bmN0aW9uRGVmaW5pdGlvbiB9IGZyb20gXCIuL0Z1bmN0aW9uXCI7XG5pbXBvcnQgeyBQZXJtaXNzaW9ucyB9IGZyb20gXCIuL3V0aWwvcGVybWlzc2lvblwiO1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIEludGVyZmFjZXNcbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5leHBvcnQgaW50ZXJmYWNlIEJ1Y2tldFByb3BzIHtcbiAgcmVhZG9ubHkgczNCdWNrZXQ/OiBzMy5CdWNrZXQgfCBzMy5CdWNrZXRQcm9wcztcbiAgcmVhZG9ubHkgbm90aWZpY2F0aW9ucz86IChcbiAgICB8IEZ1bmN0aW9uRGVmaW5pdGlvblxuICAgIHwgQnVja2V0RnVuY3Rpb25Ob3RpZmljYXRpb25Qcm9wc1xuICAgIHwgUXVldWVcbiAgICB8IEJ1Y2tldFF1ZXVlTm90aWZpY2F0aW9uUHJvcHNcbiAgICB8IFRvcGljXG4gICAgfCBCdWNrZXRUb3BpY05vdGlmaWNhdGlvblByb3BzXG4gIClbXTtcbiAgcmVhZG9ubHkgZGVmYXVsdEZ1bmN0aW9uUHJvcHM/OiBGdW5jdGlvblByb3BzO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJ1Y2tldE5vdGlmaWNhdGlvblByb3BzIHtcbiAgcmVhZG9ubHkgZXZlbnRzPzogczMuRXZlbnRUeXBlW107XG4gIHJlYWRvbmx5IGZpbHRlcnM/OiBzMy5Ob3RpZmljYXRpb25LZXlGaWx0ZXJbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWNrZXRGdW5jdGlvbk5vdGlmaWNhdGlvblByb3BzIHtcbiAgcmVhZG9ubHkgZnVuY3Rpb246IEZ1bmN0aW9uRGVmaW5pdGlvbjtcbiAgcmVhZG9ubHkgbm90aWZpY2F0aW9uUHJvcHM/OiBCdWNrZXROb3RpZmljYXRpb25Qcm9wcztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWNrZXRRdWV1ZU5vdGlmaWNhdGlvblByb3BzIHtcbiAgcmVhZG9ubHkgcXVldWU6IFF1ZXVlO1xuICByZWFkb25seSBub3RpZmljYXRpb25Qcm9wcz86IEJ1Y2tldE5vdGlmaWNhdGlvblByb3BzO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJ1Y2tldFRvcGljTm90aWZpY2F0aW9uUHJvcHMge1xuICByZWFkb25seSB0b3BpYzogVG9waWM7XG4gIHJlYWRvbmx5IG5vdGlmaWNhdGlvblByb3BzPzogQnVja2V0Tm90aWZpY2F0aW9uUHJvcHM7XG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gQ29uc3RydWN0XG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuZXhwb3J0IGNsYXNzIEJ1Y2tldCBleHRlbmRzIENvbnN0cnVjdCBpbXBsZW1lbnRzIFNTVENvbnN0cnVjdCB7XG4gIHB1YmxpYyByZWFkb25seSBzM0J1Y2tldDogczMuQnVja2V0O1xuICBwcml2YXRlIHJlYWRvbmx5IG5vdGlmaWNhdGlvbnM6IChGbiB8IFF1ZXVlIHwgVG9waWMpW107XG4gIHByaXZhdGUgcmVhZG9ubHkgcGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbE5vdGlmaWNhdGlvbnM6IFBlcm1pc3Npb25zW107XG4gIHByaXZhdGUgcmVhZG9ubHkgZGVmYXVsdEZ1bmN0aW9uUHJvcHM/OiBGdW5jdGlvblByb3BzO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzPzogQnVja2V0UHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgY29uc3QgeyBzM0J1Y2tldCwgbm90aWZpY2F0aW9ucywgZGVmYXVsdEZ1bmN0aW9uUHJvcHMgfSA9IHByb3BzIHx8IHt9O1xuICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IFtdO1xuICAgIHRoaXMucGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbE5vdGlmaWNhdGlvbnMgPSBbXTtcbiAgICB0aGlzLmRlZmF1bHRGdW5jdGlvblByb3BzID0gZGVmYXVsdEZ1bmN0aW9uUHJvcHM7XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIENyZWF0ZSBCdWNrZXRcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgaWYgKGlzQ0RLQ29uc3RydWN0KHMzQnVja2V0KSkge1xuICAgICAgdGhpcy5zM0J1Y2tldCA9IHMzQnVja2V0IGFzIHMzLkJ1Y2tldDtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgczNCdWNrZXRQcm9wcyA9IChzM0J1Y2tldCB8fCB7fSkgYXMgczMuQnVja2V0UHJvcHM7XG4gICAgICB0aGlzLnMzQnVja2V0ID0gbmV3IHMzLkJ1Y2tldCh0aGlzLCBcIkJ1Y2tldFwiLCB7XG4gICAgICAgIC4uLnMzQnVja2V0UHJvcHMsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDcmVhdGUgTm90aWZpY2F0aW9uc1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgdGhpcy5hZGROb3RpZmljYXRpb25zKHRoaXMsIG5vdGlmaWNhdGlvbnMgfHwgW10pO1xuICB9XG5cbiAgcHVibGljIGdldCBidWNrZXRBcm4oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5zM0J1Y2tldC5idWNrZXRBcm47XG4gIH1cblxuICBwdWJsaWMgZ2V0IGJ1Y2tldE5hbWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5zM0J1Y2tldC5idWNrZXROYW1lO1xuICB9XG5cbiAgcHVibGljIGdldCBub3RpZmljYXRpb25GdW5jdGlvbnMoKTogRm5bXSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9ucy5maWx0ZXIoXG4gICAgICAobm90aWZpY2F0aW9uKSA9PiBub3RpZmljYXRpb24gaW5zdGFuY2VvZiBGblxuICAgICkgYXMgRm5bXTtcbiAgfVxuXG4gIHB1YmxpYyBhZGROb3RpZmljYXRpb25zKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgbm90aWZpY2F0aW9uczogKFxuICAgICAgfCBGdW5jdGlvbkRlZmluaXRpb25cbiAgICAgIHwgQnVja2V0RnVuY3Rpb25Ob3RpZmljYXRpb25Qcm9wc1xuICAgICAgfCBRdWV1ZVxuICAgICAgfCBCdWNrZXRRdWV1ZU5vdGlmaWNhdGlvblByb3BzXG4gICAgICB8IFRvcGljXG4gICAgICB8IEJ1Y2tldFRvcGljTm90aWZpY2F0aW9uUHJvcHNcbiAgICApW11cbiAgKTogdm9pZCB7XG4gICAgbm90aWZpY2F0aW9ucy5mb3JFYWNoKChub3RpZmljYXRpb24pID0+XG4gICAgICB0aGlzLmFkZE5vdGlmaWNhdGlvbihzY29wZSwgbm90aWZpY2F0aW9uKVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgYXR0YWNoUGVybWlzc2lvbnMocGVybWlzc2lvbnM6IFBlcm1pc3Npb25zKTogdm9pZCB7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zXG4gICAgICAuZmlsdGVyKChub3RpZmljYXRpb24pID0+IG5vdGlmaWNhdGlvbiBpbnN0YW5jZW9mIEZuKVxuICAgICAgLmZvckVhY2goKG5vdGlmaWNhdGlvbikgPT4gbm90aWZpY2F0aW9uLmF0dGFjaFBlcm1pc3Npb25zKHBlcm1pc3Npb25zKSk7XG4gICAgdGhpcy5wZXJtaXNzaW9uc0F0dGFjaGVkRm9yQWxsTm90aWZpY2F0aW9ucy5wdXNoKHBlcm1pc3Npb25zKTtcbiAgfVxuXG4gIHB1YmxpYyBhdHRhY2hQZXJtaXNzaW9uc1RvTm90aWZpY2F0aW9uKFxuICAgIGluZGV4OiBudW1iZXIsXG4gICAgcGVybWlzc2lvbnM6IFBlcm1pc3Npb25zXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IHRoaXMubm90aWZpY2F0aW9uc1tpbmRleF07XG4gICAgaWYgKCEobm90aWZpY2F0aW9uIGluc3RhbmNlb2YgRm4pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDYW5ub3QgYXR0YWNoIHBlcm1pc3Npb25zIHRvIHRoZSBcIiR7dGhpcy5ub2RlLmlkfVwiIEJ1Y2tldCBub3RpZmljYXRpb24gYmVjYXVzZSBpdCdzIG5vdCBhIExhbWJkYSBmdW5jdGlvbmBcbiAgICAgICk7XG4gICAgfVxuICAgIG5vdGlmaWNhdGlvbi5hdHRhY2hQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q29uc3RydWN0TWV0YWRhdGEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiQnVja2V0XCIgYXMgY29uc3QsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG5hbWU6IHRoaXMuczNCdWNrZXQuYnVja2V0TmFtZSxcbiAgICAgICAgbm90aWZpY2F0aW9uczogdGhpcy5ub3RpZmljYXRpb25zLm1hcCgobikgPT4gZ2V0RnVuY3Rpb25SZWYobikpLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhZGROb3RpZmljYXRpb24oXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICBub3RpZmljYXRpb246XG4gICAgICB8IEZ1bmN0aW9uRGVmaW5pdGlvblxuICAgICAgfCBCdWNrZXRGdW5jdGlvbk5vdGlmaWNhdGlvblByb3BzXG4gICAgICB8IFF1ZXVlXG4gICAgICB8IEJ1Y2tldFF1ZXVlTm90aWZpY2F0aW9uUHJvcHNcbiAgICAgIHwgVG9waWNcbiAgICAgIHwgQnVja2V0VG9waWNOb3RpZmljYXRpb25Qcm9wc1xuICApOiB2b2lkIHtcbiAgICBpZiAoXG4gICAgICBub3RpZmljYXRpb24gaW5zdGFuY2VvZiBRdWV1ZSB8fFxuICAgICAgKG5vdGlmaWNhdGlvbiBhcyBCdWNrZXRRdWV1ZU5vdGlmaWNhdGlvblByb3BzKS5xdWV1ZVxuICAgICkge1xuICAgICAgbm90aWZpY2F0aW9uID0gbm90aWZpY2F0aW9uIGFzIFF1ZXVlIHwgQnVja2V0UXVldWVOb3RpZmljYXRpb25Qcm9wcztcbiAgICAgIHRoaXMuYWRkUXVldWVOb3RpZmljYXRpb24oc2NvcGUsIG5vdGlmaWNhdGlvbik7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIG5vdGlmaWNhdGlvbiBpbnN0YW5jZW9mIFRvcGljIHx8XG4gICAgICAobm90aWZpY2F0aW9uIGFzIEJ1Y2tldFRvcGljTm90aWZpY2F0aW9uUHJvcHMpLnRvcGljXG4gICAgKSB7XG4gICAgICBub3RpZmljYXRpb24gPSBub3RpZmljYXRpb24gYXMgVG9waWMgfCBCdWNrZXRUb3BpY05vdGlmaWNhdGlvblByb3BzO1xuICAgICAgdGhpcy5hZGRUb3BpY05vdGlmaWNhdGlvbihzY29wZSwgbm90aWZpY2F0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm90aWZpY2F0aW9uID0gbm90aWZpY2F0aW9uIGFzXG4gICAgICAgIHwgRnVuY3Rpb25EZWZpbml0aW9uXG4gICAgICAgIHwgQnVja2V0RnVuY3Rpb25Ob3RpZmljYXRpb25Qcm9wcztcbiAgICAgIHRoaXMuYWRkRnVuY3Rpb25Ob3RpZmljYXRpb24oc2NvcGUsIG5vdGlmaWNhdGlvbik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhZGRRdWV1ZU5vdGlmaWNhdGlvbihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIG5vdGlmaWNhdGlvbjogUXVldWUgfCBCdWNrZXRRdWV1ZU5vdGlmaWNhdGlvblByb3BzXG4gICk6IHZvaWQge1xuICAgIC8vIFBhcnNlIG5vdGlmaWNhdGlvbiBwcm9wc1xuICAgIGxldCBub3RpZmljYXRpb25Qcm9wcztcbiAgICBsZXQgcXVldWU6IFF1ZXVlO1xuICAgIGlmIChub3RpZmljYXRpb24gaW5zdGFuY2VvZiBRdWV1ZSkge1xuICAgICAgbm90aWZpY2F0aW9uID0gbm90aWZpY2F0aW9uIGFzIFF1ZXVlO1xuICAgICAgcXVldWUgPSBub3RpZmljYXRpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIG5vdGlmaWNhdGlvbiA9IG5vdGlmaWNhdGlvbiBhcyBCdWNrZXRRdWV1ZU5vdGlmaWNhdGlvblByb3BzO1xuICAgICAgbm90aWZpY2F0aW9uUHJvcHMgPSBub3RpZmljYXRpb24ubm90aWZpY2F0aW9uUHJvcHM7XG4gICAgICBxdWV1ZSA9IG5vdGlmaWNhdGlvbi5xdWV1ZTtcbiAgICB9XG4gICAgdGhpcy5ub3RpZmljYXRpb25zLnB1c2gocXVldWUpO1xuXG4gICAgLy8gQ3JlYXRlIE5vdGlmaWNhdGlvbnNcbiAgICBjb25zdCBldmVudHMgPSBub3RpZmljYXRpb25Qcm9wcz8uZXZlbnRzIHx8IFtcbiAgICAgIHMzLkV2ZW50VHlwZS5PQkpFQ1RfQ1JFQVRFRCxcbiAgICAgIHMzLkV2ZW50VHlwZS5PQkpFQ1RfUkVNT1ZFRCxcbiAgICBdO1xuICAgIGNvbnN0IGZpbHRlcnMgPSBub3RpZmljYXRpb25Qcm9wcz8uZmlsdGVycyB8fCBbXTtcbiAgICBldmVudHMuZm9yRWFjaCgoZXZlbnQpID0+XG4gICAgICB0aGlzLnMzQnVja2V0LmFkZEV2ZW50Tm90aWZpY2F0aW9uKFxuICAgICAgICBldmVudCxcbiAgICAgICAgbmV3IHMzTm90aWZpY2F0aW9ucy5TcXNEZXN0aW5hdGlvbihxdWV1ZS5zcXNRdWV1ZSksXG4gICAgICAgIC4uLmZpbHRlcnNcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRUb3BpY05vdGlmaWNhdGlvbihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIG5vdGlmaWNhdGlvbjogVG9waWMgfCBCdWNrZXRUb3BpY05vdGlmaWNhdGlvblByb3BzXG4gICk6IHZvaWQge1xuICAgIC8vIFBhcnNlIG5vdGlmaWNhdGlvbiBwcm9wc1xuICAgIGxldCBub3RpZmljYXRpb25Qcm9wcztcbiAgICBsZXQgdG9waWM6IFRvcGljO1xuICAgIGlmIChub3RpZmljYXRpb24gaW5zdGFuY2VvZiBUb3BpYykge1xuICAgICAgbm90aWZpY2F0aW9uID0gbm90aWZpY2F0aW9uIGFzIFRvcGljO1xuICAgICAgdG9waWMgPSBub3RpZmljYXRpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIG5vdGlmaWNhdGlvbiA9IG5vdGlmaWNhdGlvbiBhcyBCdWNrZXRUb3BpY05vdGlmaWNhdGlvblByb3BzO1xuICAgICAgbm90aWZpY2F0aW9uUHJvcHMgPSBub3RpZmljYXRpb24ubm90aWZpY2F0aW9uUHJvcHM7XG4gICAgICB0b3BpYyA9IG5vdGlmaWNhdGlvbi50b3BpYztcbiAgICB9XG4gICAgdGhpcy5ub3RpZmljYXRpb25zLnB1c2godG9waWMpO1xuXG4gICAgLy8gQ3JlYXRlIE5vdGlmaWNhdGlvbnNcbiAgICBjb25zdCBldmVudHMgPSBub3RpZmljYXRpb25Qcm9wcz8uZXZlbnRzIHx8IFtcbiAgICAgIHMzLkV2ZW50VHlwZS5PQkpFQ1RfQ1JFQVRFRCxcbiAgICAgIHMzLkV2ZW50VHlwZS5PQkpFQ1RfUkVNT1ZFRCxcbiAgICBdO1xuICAgIGNvbnN0IGZpbHRlcnMgPSBub3RpZmljYXRpb25Qcm9wcz8uZmlsdGVycyB8fCBbXTtcbiAgICBldmVudHMuZm9yRWFjaCgoZXZlbnQpID0+XG4gICAgICB0aGlzLnMzQnVja2V0LmFkZEV2ZW50Tm90aWZpY2F0aW9uKFxuICAgICAgICBldmVudCxcbiAgICAgICAgbmV3IHMzTm90aWZpY2F0aW9ucy5TbnNEZXN0aW5hdGlvbih0b3BpYy5zbnNUb3BpYyksXG4gICAgICAgIC4uLmZpbHRlcnNcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRGdW5jdGlvbk5vdGlmaWNhdGlvbihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIG5vdGlmaWNhdGlvbjogRnVuY3Rpb25EZWZpbml0aW9uIHwgQnVja2V0RnVuY3Rpb25Ob3RpZmljYXRpb25Qcm9wc1xuICApOiB2b2lkIHtcbiAgICAvLyBwYXJzZSBub3RpZmljYXRpb25cbiAgICBsZXQgbm90aWZpY2F0aW9uRnVuY3Rpb24sIG5vdGlmaWNhdGlvblByb3BzO1xuICAgIGlmICgobm90aWZpY2F0aW9uIGFzIEJ1Y2tldEZ1bmN0aW9uTm90aWZpY2F0aW9uUHJvcHMpLmZ1bmN0aW9uKSB7XG4gICAgICBub3RpZmljYXRpb24gPSBub3RpZmljYXRpb24gYXMgQnVja2V0RnVuY3Rpb25Ob3RpZmljYXRpb25Qcm9wcztcbiAgICAgIG5vdGlmaWNhdGlvbkZ1bmN0aW9uID0gbm90aWZpY2F0aW9uLmZ1bmN0aW9uO1xuICAgICAgbm90aWZpY2F0aW9uUHJvcHMgPSBub3RpZmljYXRpb24ubm90aWZpY2F0aW9uUHJvcHM7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5vdGlmaWNhdGlvbkZ1bmN0aW9uID0gbm90aWZpY2F0aW9uIGFzIEZ1bmN0aW9uRGVmaW5pdGlvbjtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgZnVuY3Rpb25cbiAgICBjb25zdCBpID0gdGhpcy5ub3RpZmljYXRpb25zLmxlbmd0aDtcbiAgICBjb25zdCBmbiA9IEZuLmZyb21EZWZpbml0aW9uKFxuICAgICAgc2NvcGUsXG4gICAgICBgTm90aWZpY2F0aW9uXyR7dGhpcy5ub2RlLmlkfV8ke2l9YCxcbiAgICAgIG5vdGlmaWNhdGlvbkZ1bmN0aW9uLFxuICAgICAgdGhpcy5kZWZhdWx0RnVuY3Rpb25Qcm9wcyxcbiAgICAgIGBUaGUgXCJkZWZhdWx0RnVuY3Rpb25Qcm9wc1wiIGNhbm5vdCBiZSBhcHBsaWVkIGlmIGFuIGluc3RhbmNlIG9mIGEgRnVuY3Rpb24gY29uc3RydWN0IGlzIHBhc3NlZCBpbi4gTWFrZSBzdXJlIHRvIGRlZmluZSBhbGwgdGhlIGNvbnN1bWVycyB1c2luZyBGdW5jdGlvblByb3BzLCBzbyB0aGUgVGFibGUgY29uc3RydWN0IGNhbiBhcHBseSB0aGUgXCJkZWZhdWx0RnVuY3Rpb25Qcm9wc1wiIHRvIHRoZW0uYFxuICAgICk7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zLnB1c2goZm4pO1xuXG4gICAgLy8gY3JlYXRlIE5vdGlmaWNhdGlvbnNcbiAgICBjb25zdCBldmVudHMgPSBub3RpZmljYXRpb25Qcm9wcz8uZXZlbnRzIHx8IFtcbiAgICAgIHMzLkV2ZW50VHlwZS5PQkpFQ1RfQ1JFQVRFRCxcbiAgICAgIHMzLkV2ZW50VHlwZS5PQkpFQ1RfUkVNT1ZFRCxcbiAgICBdO1xuICAgIGNvbnN0IGZpbHRlcnMgPSBub3RpZmljYXRpb25Qcm9wcz8uZmlsdGVycyB8fCBbXTtcbiAgICBldmVudHMuZm9yRWFjaCgoZXZlbnQpID0+XG4gICAgICB0aGlzLnMzQnVja2V0LmFkZEV2ZW50Tm90aWZpY2F0aW9uKFxuICAgICAgICBldmVudCxcbiAgICAgICAgbmV3IHMzTm90aWZpY2F0aW9ucy5MYW1iZGFEZXN0aW5hdGlvbihmbiksXG4gICAgICAgIC4uLmZpbHRlcnNcbiAgICAgIClcbiAgICApO1xuXG4gICAgLy8gYXR0YWNoZWQgcGVybWlzc2lvbnNcbiAgICB0aGlzLnBlcm1pc3Npb25zQXR0YWNoZWRGb3JBbGxOb3RpZmljYXRpb25zLmZvckVhY2goKHBlcm1pc3Npb25zKSA9PlxuICAgICAgZm4uYXR0YWNoUGVybWlzc2lvbnMocGVybWlzc2lvbnMpXG4gICAgKTtcbiAgfVxufVxuIl19