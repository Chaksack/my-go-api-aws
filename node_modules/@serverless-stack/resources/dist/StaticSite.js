"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.StaticSite = exports.StaticSiteErrorOptions = void 0;
const chalk_1 = __importDefault(require("chalk"));
const path = __importStar(require("path"));
const fs = __importStar(require("fs-extra"));
const crypto = __importStar(require("crypto"));
const child_process_1 = require("child_process");
const constructs_1 = require("constructs");
const cdk = __importStar(require("aws-cdk-lib"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const s3Assets = __importStar(require("aws-cdk-lib/aws-s3-assets"));
const acm = __importStar(require("aws-cdk-lib/aws-certificatemanager"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const route53 = __importStar(require("aws-cdk-lib/aws-route53"));
const route53Patterns = __importStar(require("aws-cdk-lib/aws-route53-patterns"));
const route53Targets = __importStar(require("aws-cdk-lib/aws-route53-targets"));
const cloudfront = __importStar(require("aws-cdk-lib/aws-cloudfront"));
const cfOrigins = __importStar(require("aws-cdk-lib/aws-cloudfront-origins"));
const lambda_layer_awscli_1 = require("aws-cdk-lib/lambda-layer-awscli");
const BaseSite_1 = require("./BaseSite");
const Construct_1 = require("./Construct");
var StaticSiteErrorOptions;
(function (StaticSiteErrorOptions) {
    StaticSiteErrorOptions["REDIRECT_TO_INDEX_PAGE"] = "REDIRECT_TO_INDEX_PAGE";
})(StaticSiteErrorOptions = exports.StaticSiteErrorOptions || (exports.StaticSiteErrorOptions = {}));
class StaticSite extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        const root = scope.node.root;
        // Local development or skip build => stub asset
        this.isPlaceholder =
            (root.local || root.skipBuild) && !props.disablePlaceholder;
        const buildDir = root.buildDir;
        const fileSizeLimit = root.isJestTest()
            ? // eslint-disable-next-line @typescript-eslint/ban-ts-comment
                // @ts-ignore: "jestFileSizeLimitOverride" not exposed in props
                props.jestFileSizeLimitOverride || 200
            : 200;
        this.props = props;
        this.awsCliLayer = new lambda_layer_awscli_1.AwsCliLayer(this, "AwsCliLayer");
        this.registerSiteEnvironment();
        // Validate input
        this.validateCustomDomainSettings();
        // Build app
        this.buildApp();
        this.assets = this.bundleAssets(fileSizeLimit, buildDir);
        this.filenamesAsset = this.bundleFilenamesAsset(buildDir);
        // Create Bucket
        this.s3Bucket = this.createS3Bucket();
        // Create Custom Domain
        this.hostedZone = this.lookupHostedZone();
        this.acmCertificate = this.createCertificate();
        // Create S3 Deployment
        const s3deployCR = this.createS3Deployment();
        // Create CloudFront
        this.cfDistribution = this.createCfDistribution();
        this.cfDistribution.node.addDependency(s3deployCR);
        // Invalidate CloudFront
        const invalidationCR = this.createCloudFrontInvalidation();
        invalidationCR.node.addDependency(this.cfDistribution);
        // Connect Custom Domain to CloudFront Distribution
        this.createRoute53Records();
    }
    get url() {
        return `https://${this.cfDistribution.distributionDomainName}`;
    }
    get customDomainUrl() {
        const { customDomain } = this.props;
        if (!customDomain) {
            return;
        }
        if (typeof customDomain === "string") {
            return `https://${customDomain}`;
        }
        else {
            return `https://${customDomain.domainName}`;
        }
    }
    get bucketArn() {
        return this.s3Bucket.bucketArn;
    }
    get bucketName() {
        return this.s3Bucket.bucketName;
    }
    get distributionId() {
        return this.cfDistribution.distributionId;
    }
    get distributionDomain() {
        return this.cfDistribution.distributionDomainName;
    }
    getConstructMetadata() {
        return {
            type: "StaticSite",
            data: {
                distributionId: this.cfDistribution.distributionId,
                customDomainUrl: this.customDomainUrl,
            },
        };
    }
    buildApp() {
        if (this.isPlaceholder) {
            return;
        }
        const { path: sitePath, buildCommand } = this.props;
        // validate site path exists
        if (!fs.existsSync(sitePath)) {
            throw new Error(`No path found at "${path.resolve(sitePath)}" for the "${this.node.id}" StaticSite.`);
        }
        // build
        if (buildCommand) {
            try {
                console.log(chalk_1.default.grey(`Building static site ${sitePath}`));
                (0, child_process_1.execSync)(buildCommand, {
                    cwd: sitePath,
                    stdio: "inherit",
                    env: Object.assign(Object.assign({}, process.env), (0, BaseSite_1.getBuildCmdEnvironment)(this.props.environment)),
                });
            }
            catch (e) {
                throw new Error(`There was a problem building the "${this.node.id}" StaticSite.`);
            }
        }
    }
    bundleAssets(fileSizeLimit, buildDir) {
        if (this.isPlaceholder) {
            return [
                new s3Assets.Asset(this, "Asset", {
                    path: path.resolve(__dirname, "../assets/StaticSite/stub"),
                }),
            ];
        }
        const { path: sitePath, buildCommand } = this.props;
        const buildOutput = this.props.buildOutput || ".";
        // validate buildOutput exists
        const siteOutputPath = path.resolve(path.join(sitePath, buildOutput));
        if (!fs.existsSync(siteOutputPath)) {
            throw new Error(`No build output found at "${siteOutputPath}" for the "${this.node.id}" StaticSite.`);
        }
        // create zip files
        const script = path.join(__dirname, "../assets/BaseSite/archiver.js");
        const zipPath = path.resolve(path.join(buildDir, `StaticSite-${this.node.id}-${this.node.addr}`));
        // clear zip path to ensure no partX.zip remain from previous build
        fs.removeSync(zipPath);
        const cmd = ["node", script, siteOutputPath, zipPath, fileSizeLimit].join(" ");
        try {
            (0, child_process_1.execSync)(cmd, {
                cwd: sitePath,
                stdio: "inherit",
            });
        }
        catch (e) {
            throw new Error(`There was a problem generating the "${this.node.id}" StaticSite package.`);
        }
        // create assets
        const assets = [];
        for (let partId = 0;; partId++) {
            const zipFilePath = path.join(zipPath, `part${partId}.zip`);
            if (!fs.existsSync(zipFilePath)) {
                break;
            }
            assets.push(new s3Assets.Asset(this, `Asset${partId}`, {
                path: zipFilePath,
            }));
        }
        return assets;
    }
    bundleFilenamesAsset(buildDir) {
        if (this.isPlaceholder) {
            return;
        }
        if (this.props.purgeFiles === false) {
            return;
        }
        const zipPath = path.resolve(path.join(buildDir, `StaticSite-${this.node.id}-${this.node.addr}`));
        // create assets
        const filenamesPath = path.join(zipPath, `filenames`);
        if (!fs.existsSync(filenamesPath)) {
            throw new Error(`There was a problem generating the "${this.node.id}" StaticSite package.`);
        }
        return new s3Assets.Asset(this, `AssetFilenames`, {
            path: filenamesPath,
        });
    }
    createS3Bucket() {
        let { s3Bucket } = this.props;
        s3Bucket = s3Bucket || {};
        // Validate s3Bucket
        if (s3Bucket.websiteIndexDocument) {
            throw new Error(`Do not configure the "s3Bucket.websiteIndexDocument". Use the "indexPage" to configure the StaticSite index page.`);
        }
        if (s3Bucket.websiteErrorDocument) {
            throw new Error(`Do not configure the "s3Bucket.websiteErrorDocument". Use the "errorPage" to configure the StaticSite index page.`);
        }
        return new s3.Bucket(this, "S3Bucket", Object.assign({ autoDeleteObjects: true, removalPolicy: cdk.RemovalPolicy.DESTROY }, s3Bucket));
    }
    createS3Deployment() {
        var _a;
        const { fileOptions } = this.props;
        // Create a Lambda function that will be doing the uploading
        const uploader = new lambda.Function(this, "S3Uploader", {
            code: lambda.Code.fromAsset(path.join(__dirname, "../assets/BaseSite/custom-resource")),
            layers: [this.awsCliLayer],
            runtime: lambda.Runtime.PYTHON_3_7,
            handler: "s3-upload.handler",
            timeout: cdk.Duration.minutes(15),
            memorySize: 1024,
        });
        this.s3Bucket.grantReadWrite(uploader);
        this.assets.forEach((asset) => asset.grantRead(uploader));
        // Create the custom resource function
        const handler = new lambda.Function(this, "S3Handler", {
            code: lambda.Code.fromAsset(path.join(__dirname, "../assets/BaseSite/custom-resource")),
            layers: [this.awsCliLayer],
            runtime: lambda.Runtime.PYTHON_3_7,
            handler: "s3-handler.handler",
            timeout: cdk.Duration.minutes(15),
            memorySize: 1024,
            environment: {
                UPLOADER_FUNCTION_NAME: uploader.functionName,
            },
        });
        this.s3Bucket.grantReadWrite(handler);
        (_a = this.filenamesAsset) === null || _a === void 0 ? void 0 : _a.grantRead(handler);
        uploader.grantInvoke(handler);
        // Create custom resource
        return new cdk.CustomResource(this, "S3Deployment", {
            serviceToken: handler.functionArn,
            resourceType: "Custom::SSTBucketDeployment",
            properties: {
                Sources: this.assets.map((asset) => ({
                    BucketName: asset.s3BucketName,
                    ObjectKey: asset.s3ObjectKey,
                })),
                DestinationBucketName: this.s3Bucket.bucketName,
                Filenames: this.filenamesAsset && {
                    BucketName: this.filenamesAsset.s3BucketName,
                    ObjectKey: this.filenamesAsset.s3ObjectKey,
                },
                FileOptions: (fileOptions || []).map(({ exclude, include, cacheControl }) => {
                    if (typeof exclude === "string") {
                        exclude = [exclude];
                    }
                    if (typeof include === "string") {
                        include = [include];
                    }
                    const options = [];
                    exclude.forEach((per) => options.push("--exclude", per));
                    include.forEach((per) => options.push("--include", per));
                    options.push("--cache-control", cacheControl);
                    return options;
                }),
                ReplaceValues: this.getS3ContentReplaceValues(),
            },
        });
    }
    /////////////////////
    // CloudFront Distribution
    /////////////////////
    createCfDistribution() {
        const { cfDistribution, customDomain } = this.props;
        const indexPage = this.props.indexPage || "index.html";
        const errorPage = this.props.errorPage;
        const cfDistributionProps = cfDistribution || {};
        // Validate input
        if (cfDistributionProps.certificate) {
            throw new Error(`Do not configure the "cfDistribution.certificate". Use the "customDomain" to configure the StaticSite domain certificate.`);
        }
        if (cfDistributionProps.domainNames) {
            throw new Error(`Do not configure the "cfDistribution.domainNames". Use the "customDomain" to configure the StaticSite domain.`);
        }
        // Build domainNames
        const domainNames = [];
        if (!customDomain) {
            // no domain
        }
        else if (typeof customDomain === "string") {
            domainNames.push(customDomain);
        }
        else {
            domainNames.push(customDomain.domainName);
            if (customDomain.alternateNames) {
                if (!customDomain.certificate)
                    throw new Error("Certificates for alternate domains cannot be automatically created. Please specify certificate to use");
                domainNames.push(...customDomain.alternateNames);
            }
        }
        // Build errorResponses
        let errorResponses;
        // case: sst start => showing stub site, and redirect all routes to the index page
        if (this.isPlaceholder) {
            errorResponses = (0, BaseSite_1.buildErrorResponsesForRedirectToIndex)(indexPage);
        }
        else if (errorPage) {
            if (cfDistributionProps.errorResponses) {
                throw new Error(`Cannot configure the "cfDistribution.errorResponses" when "errorPage" is passed in. Use one or the other to configure the behavior for error pages.`);
            }
            errorResponses =
                errorPage === StaticSiteErrorOptions.REDIRECT_TO_INDEX_PAGE
                    ? (0, BaseSite_1.buildErrorResponsesForRedirectToIndex)(indexPage)
                    : (0, BaseSite_1.buildErrorResponsesFor404ErrorPage)(errorPage);
        }
        // Create CloudFront distribution
        return new cloudfront.Distribution(this, "Distribution", Object.assign(Object.assign({ 
            // these values can be overwritten by cfDistributionProps
            defaultRootObject: indexPage, errorResponses }, cfDistributionProps), { 
            // these values can NOT be overwritten by cfDistributionProps
            domainNames, certificate: this.acmCertificate, defaultBehavior: Object.assign({ origin: new cfOrigins.S3Origin(this.s3Bucket), viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS }, (cfDistributionProps.defaultBehavior || {})) }));
    }
    createCloudFrontInvalidation() {
        // Create a Lambda function that will be doing the invalidation
        const invalidator = new lambda.Function(this, "CloudFrontInvalidator", {
            code: lambda.Code.fromAsset(path.join(__dirname, "../assets/BaseSite/custom-resource")),
            layers: [this.awsCliLayer],
            runtime: lambda.Runtime.PYTHON_3_7,
            handler: "cf-invalidate.handler",
            timeout: cdk.Duration.minutes(15),
            memorySize: 1024,
        });
        // Grant permissions to invalidate CF Distribution
        invalidator.addToRolePolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [
                "cloudfront:GetInvalidation",
                "cloudfront:CreateInvalidation",
            ],
            resources: ["*"],
        }));
        // Need the AssetHash field so the CR gets updated on each deploy
        const assetsHash = crypto
            .createHash("md5")
            .update(this.assets.map(({ assetHash }) => assetHash).join(""))
            .digest("hex");
        // Create custom resource
        const waitForInvalidation = this.props.waitForInvalidation === false ? false : true;
        return new cdk.CustomResource(this, "CloudFrontInvalidation", {
            serviceToken: invalidator.functionArn,
            resourceType: "Custom::SSTCloudFrontInvalidation",
            properties: {
                AssetsHash: assetsHash,
                DistributionId: this.cfDistribution.distributionId,
                DistributionPaths: ["/*"],
                WaitForInvalidation: waitForInvalidation,
            },
        });
    }
    /////////////////////
    // Custom Domain
    /////////////////////
    validateCustomDomainSettings() {
        const { customDomain } = this.props;
        if (!customDomain) {
            return;
        }
        if (typeof customDomain === "string") {
            return;
        }
        if (customDomain.isExternalDomain === true) {
            if (!customDomain.certificate) {
                throw new Error(`A valid certificate is required when "isExternalDomain" is set to "true".`);
            }
            if (customDomain.domainAlias) {
                throw new Error(`Domain alias is only supported for domains hosted on Amazon Route 53. Do not set the "customDomain.domainAlias" when "isExternalDomain" is enabled.`);
            }
            if (customDomain.hostedZone) {
                throw new Error(`Hosted zones can only be configured for domains hosted on Amazon Route 53. Do not set the "customDomain.hostedZone" when "isExternalDomain" is enabled.`);
            }
        }
    }
    lookupHostedZone() {
        const { customDomain } = this.props;
        // Skip if customDomain is not configured
        if (!customDomain) {
            return;
        }
        let hostedZone;
        if (typeof customDomain === "string") {
            hostedZone = route53.HostedZone.fromLookup(this, "HostedZone", {
                domainName: customDomain,
            });
        }
        else if ((0, Construct_1.isCDKConstruct)(customDomain.hostedZone)) {
            hostedZone = customDomain.hostedZone;
        }
        else if (typeof customDomain.hostedZone === "string") {
            hostedZone = route53.HostedZone.fromLookup(this, "HostedZone", {
                domainName: customDomain.hostedZone,
            });
        }
        else if (typeof customDomain.domainName === "string") {
            // Skip if domain is not a Route53 domain
            if (customDomain.isExternalDomain === true) {
                return;
            }
            hostedZone = route53.HostedZone.fromLookup(this, "HostedZone", {
                domainName: customDomain.domainName,
            });
        }
        else {
            hostedZone = customDomain.hostedZone;
        }
        return hostedZone;
    }
    createCertificate() {
        const { customDomain } = this.props;
        if (!customDomain) {
            return;
        }
        let acmCertificate;
        // HostedZone is set for Route 53 domains
        if (this.hostedZone) {
            if (typeof customDomain === "string") {
                acmCertificate = new acm.DnsValidatedCertificate(this, "Certificate", {
                    domainName: customDomain,
                    hostedZone: this.hostedZone,
                    region: "us-east-1",
                });
            }
            else if (customDomain.certificate) {
                acmCertificate = customDomain.certificate;
            }
            else {
                acmCertificate = new acm.DnsValidatedCertificate(this, "Certificate", {
                    domainName: customDomain.domainName,
                    hostedZone: this.hostedZone,
                    region: "us-east-1",
                });
            }
        }
        // HostedZone is NOT set for non-Route 53 domains
        else {
            if (typeof customDomain !== "string") {
                acmCertificate = customDomain.certificate;
            }
        }
        return acmCertificate;
    }
    createRoute53Records() {
        const { customDomain } = this.props;
        if (!customDomain || !this.hostedZone) {
            return;
        }
        let recordName;
        let domainAlias;
        if (typeof customDomain === "string") {
            recordName = customDomain;
        }
        else {
            recordName = customDomain.domainName;
            domainAlias = customDomain.domainAlias;
        }
        // Create DNS record
        const recordProps = {
            recordName,
            zone: this.hostedZone,
            target: route53.RecordTarget.fromAlias(new route53Targets.CloudFrontTarget(this.cfDistribution)),
        };
        new route53.ARecord(this, "AliasRecord", recordProps);
        new route53.AaaaRecord(this, "AliasRecordAAAA", recordProps);
        // Create Alias redirect record
        if (domainAlias) {
            new route53Patterns.HttpsRedirect(this, "Redirect", {
                zone: this.hostedZone,
                recordNames: [domainAlias],
                targetDomain: recordName,
            });
        }
    }
    /////////////////////
    // Helper Functions
    /////////////////////
    getS3ContentReplaceValues() {
        const replaceValues = this.props.replaceValues || [];
        Object.entries(this.props.environment || {})
            .filter(([, value]) => cdk.Token.isUnresolved(value))
            .forEach(([key, value]) => {
            const token = `{{ ${key} }}`;
            replaceValues.push({
                files: "**/*.html",
                search: token,
                replace: value,
            }, {
                files: "**/*.js",
                search: token,
                replace: value,
            });
        });
        return replaceValues;
    }
    registerSiteEnvironment() {
        const environmentOutputs = {};
        for (const [key, value] of Object.entries(this.props.environment || {})) {
            const outputId = `SstSiteEnv_${key}`;
            const output = new cdk.CfnOutput(this, outputId, { value });
            environmentOutputs[key] = cdk.Stack.of(this).getLogicalId(output);
        }
        const root = this.node.root;
        root.registerSiteEnvironment({
            id: this.node.id,
            path: this.props.path,
            stack: cdk.Stack.of(this).node.id,
            environmentOutputs,
        });
    }
}
exports.StaticSite = StaticSite;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhdGljU2l0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9TdGF0aWNTaXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsa0RBQTBCO0FBQzFCLDJDQUE2QjtBQUM3Qiw2Q0FBK0I7QUFDL0IsK0NBQWlDO0FBQ2pDLGlEQUF5QztBQUV6QywyQ0FBdUM7QUFDdkMsaURBQW1DO0FBQ25DLHVEQUF5QztBQUN6QyxvRUFBc0Q7QUFDdEQsd0VBQTBEO0FBQzFELHlEQUEyQztBQUMzQywrREFBaUQ7QUFDakQsaUVBQW1EO0FBQ25ELGtGQUFvRTtBQUNwRSxnRkFBa0U7QUFDbEUsdUVBQXlEO0FBQ3pELDhFQUFnRTtBQUNoRSx5RUFBOEQ7QUFHOUQseUNBUW9CO0FBQ3BCLDJDQUEyRDtBQUUzRCxJQUFZLHNCQUVYO0FBRkQsV0FBWSxzQkFBc0I7SUFDaEMsMkVBQWlELENBQUE7QUFDbkQsQ0FBQyxFQUZXLHNCQUFzQixHQUF0Qiw4QkFBc0IsS0FBdEIsOEJBQXNCLFFBRWpDO0FBNkJELE1BQWEsVUFBVyxTQUFRLHNCQUFTO0lBV3ZDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBc0I7UUFDOUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQVcsQ0FBQztRQUNwQyxnREFBZ0Q7UUFDaEQsSUFBSSxDQUFDLGFBQWE7WUFDaEIsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztRQUM5RCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQy9CLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDckMsQ0FBQyxDQUFDLDZEQUE2RDtnQkFDN0QsK0RBQStEO2dC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Y2hhbGtcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmcy1leHRyYVwiO1xuaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSBcImNoaWxkX3Byb2Nlc3NcIjtcblxuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCAqIGFzIGNkayBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCAqIGFzIHMzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtczNcIjtcbmltcG9ydCAqIGFzIHMzQXNzZXRzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtczMtYXNzZXRzXCI7XG5pbXBvcnQgKiBhcyBhY20gZnJvbSBcImF3cy1jZGstbGliL2F3cy1jZXJ0aWZpY2F0ZW1hbmFnZXJcIjtcbmltcG9ydCAqIGFzIGlhbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWlhbVwiO1xuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbGFtYmRhXCI7XG5pbXBvcnQgKiBhcyByb3V0ZTUzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtcm91dGU1M1wiO1xuaW1wb3J0ICogYXMgcm91dGU1M1BhdHRlcm5zIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtcm91dGU1My1wYXR0ZXJuc1wiO1xuaW1wb3J0ICogYXMgcm91dGU1M1RhcmdldHMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1yb3V0ZTUzLXRhcmdldHNcIjtcbmltcG9ydCAqIGFzIGNsb3VkZnJvbnQgZnJvbSBcImF3cy1jZGstbGliL2F3cy1jbG91ZGZyb250XCI7XG5pbXBvcnQgKiBhcyBjZk9yaWdpbnMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1jbG91ZGZyb250LW9yaWdpbnNcIjtcbmltcG9ydCB7IEF3c0NsaUxheWVyIH0gZnJvbSBcImF3cy1jZGstbGliL2xhbWJkYS1sYXllci1hd3NjbGlcIjtcblxuaW1wb3J0IHsgQXBwIH0gZnJvbSBcIi4vQXBwXCI7XG5pbXBvcnQge1xuICBCYXNlU2l0ZURvbWFpblByb3BzLFxuICBCYXNlU2l0ZVJlcGxhY2VQcm9wcyxcbiAgQmFzZVNpdGVDZGtEaXN0cmlidXRpb25Qcm9wcyxcbiAgQmFzZVNpdGVFbnZpcm9ubWVudE91dHB1dHNJbmZvLFxuICBnZXRCdWlsZENtZEVudmlyb25tZW50LFxuICBidWlsZEVycm9yUmVzcG9uc2VzRm9yNDA0RXJyb3JQYWdlLFxuICBidWlsZEVycm9yUmVzcG9uc2VzRm9yUmVkaXJlY3RUb0luZGV4LFxufSBmcm9tIFwiLi9CYXNlU2l0ZVwiO1xuaW1wb3J0IHsgU1NUQ29uc3RydWN0LCBpc0NES0NvbnN0cnVjdCB9IGZyb20gXCIuL0NvbnN0cnVjdFwiO1xuXG5leHBvcnQgZW51bSBTdGF0aWNTaXRlRXJyb3JPcHRpb25zIHtcbiAgUkVESVJFQ1RfVE9fSU5ERVhfUEFHRSA9IFwiUkVESVJFQ1RfVE9fSU5ERVhfUEFHRVwiLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRpY1NpdGVQcm9wcyB7XG4gIHJlYWRvbmx5IHBhdGg6IHN0cmluZztcbiAgcmVhZG9ubHkgaW5kZXhQYWdlPzogc3RyaW5nO1xuICByZWFkb25seSBlcnJvclBhZ2U/OiBzdHJpbmcgfCBTdGF0aWNTaXRlRXJyb3JPcHRpb25zO1xuICByZWFkb25seSBidWlsZENvbW1hbmQ/OiBzdHJpbmc7XG4gIHJlYWRvbmx5IGJ1aWxkT3V0cHV0Pzogc3RyaW5nO1xuICByZWFkb25seSBmaWxlT3B0aW9ucz86IFN0YXRpY1NpdGVGaWxlT3B0aW9uW107XG4gIHJlYWRvbmx5IHJlcGxhY2VWYWx1ZXM/OiBTdGF0aWNTaXRlUmVwbGFjZVByb3BzW107XG4gIHJlYWRvbmx5IGN1c3RvbURvbWFpbj86IHN0cmluZyB8IFN0YXRpY1NpdGVEb21haW5Qcm9wcztcbiAgcmVhZG9ubHkgczNCdWNrZXQ/OiBzMy5CdWNrZXRQcm9wcztcbiAgcmVhZG9ubHkgY2ZEaXN0cmlidXRpb24/OiBTdGF0aWNTaXRlQ2RrRGlzdHJpYnV0aW9uUHJvcHM7XG4gIHJlYWRvbmx5IGVudmlyb25tZW50PzogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfTtcbiAgcmVhZG9ubHkgcHVyZ2VGaWxlcz86IGJvb2xlYW47XG4gIHJlYWRvbmx5IGRpc2FibGVQbGFjZWhvbGRlcj86IGJvb2xlYW47XG4gIHJlYWRvbmx5IHdhaXRGb3JJbnZhbGlkYXRpb24/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRpY1NpdGVGaWxlT3B0aW9uIHtcbiAgcmVhZG9ubHkgZXhjbHVkZTogc3RyaW5nIHwgc3RyaW5nW107XG4gIHJlYWRvbmx5IGluY2x1ZGU6IHN0cmluZyB8IHN0cmluZ1tdO1xuICByZWFkb25seSBjYWNoZUNvbnRyb2w6IHN0cmluZztcbn1cblxuZXhwb3J0IHR5cGUgU3RhdGljU2l0ZURvbWFpblByb3BzID0gQmFzZVNpdGVEb21haW5Qcm9wcztcbmV4cG9ydCB0eXBlIFN0YXRpY1NpdGVSZXBsYWNlUHJvcHMgPSBCYXNlU2l0ZVJlcGxhY2VQcm9wcztcbmV4cG9ydCB0eXBlIFN0YXRpY1NpdGVDZGtEaXN0cmlidXRpb25Qcm9wcyA9IEJhc2VTaXRlQ2RrRGlzdHJpYnV0aW9uUHJvcHM7XG5cbmV4cG9ydCBjbGFzcyBTdGF0aWNTaXRlIGV4dGVuZHMgQ29uc3RydWN0IGltcGxlbWVudHMgU1NUQ29uc3RydWN0IHtcbiAgcHVibGljIHJlYWRvbmx5IHMzQnVja2V0OiBzMy5CdWNrZXQ7XG4gIHB1YmxpYyByZWFkb25seSBjZkRpc3RyaWJ1dGlvbjogY2xvdWRmcm9udC5EaXN0cmlidXRpb247XG4gIHB1YmxpYyByZWFkb25seSBob3N0ZWRab25lPzogcm91dGU1My5JSG9zdGVkWm9uZTtcbiAgcHVibGljIHJlYWRvbmx5IGFjbUNlcnRpZmljYXRlPzogYWNtLklDZXJ0aWZpY2F0ZTtcbiAgcHJpdmF0ZSByZWFkb25seSBwcm9wczogU3RhdGljU2l0ZVByb3BzO1xuICBwcml2YXRlIHJlYWRvbmx5IGlzUGxhY2Vob2xkZXI6IGJvb2xlYW47XG4gIHByaXZhdGUgcmVhZG9ubHkgYXNzZXRzOiBzM0Fzc2V0cy5Bc3NldFtdO1xuICBwcml2YXRlIHJlYWRvbmx5IGZpbGVuYW1lc0Fzc2V0PzogczNBc3NldHMuQXNzZXQ7XG4gIHByaXZhdGUgcmVhZG9ubHkgYXdzQ2xpTGF5ZXI6IEF3c0NsaUxheWVyO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBTdGF0aWNTaXRlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgY29uc3Qgcm9vdCA9IHNjb3BlLm5vZGUucm9vdCBhcyBBcHA7XG4gICAgLy8gTG9jYWwgZGV2ZWxvcG1lbnQgb3Igc2tpcCBidWlsZCA9PiBzdHViIGFzc2V0XG4gICAgdGhpcy5pc1BsYWNlaG9sZGVyID1cbiAgICAgIChyb290LmxvY2FsIHx8IHJvb3Quc2tpcEJ1aWxkKSAmJiAhcHJvcHMuZGlzYWJsZVBsYWNlaG9sZGVyO1xuICAgIGNvbnN0IGJ1aWxkRGlyID0gcm9vdC5idWlsZERpcjtcbiAgICBjb25zdCBmaWxlU2l6ZUxpbWl0ID0gcm9vdC5pc0plc3RUZXN0KClcbiAgICAgID8gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgICAvLyBAdHMtaWdub3JlOiBcImplc3RGaWxlU2l6ZUxpbWl0T3ZlcnJpZGVcIiBub3QgZXhwb3NlZCBpbiBwcm9wc1xuICAgICAgICBwcm9wcy5qZXN0RmlsZVNpemVMaW1pdE92ZXJyaWRlIHx8IDIwMFxuICAgICAgOiAyMDA7XG5cbiAgICB0aGlzLnByb3BzID0gcHJvcHM7XG4gICAgdGhpcy5hd3NDbGlMYXllciA9IG5ldyBBd3NDbGlMYXllcih0aGlzLCBcIkF3c0NsaUxheWVyXCIpO1xuICAgIHRoaXMucmVnaXN0ZXJTaXRlRW52aXJvbm1lbnQoKTtcblxuICAgIC8vIFZhbGlkYXRlIGlucHV0XG4gICAgdGhpcy52YWxpZGF0ZUN1c3RvbURvbWFpblNldHRpbmdzKCk7XG5cbiAgICAvLyBCdWlsZCBhcHBcbiAgICB0aGlzLmJ1aWxkQXBwKCk7XG4gICAgdGhpcy5hc3NldHMgPSB0aGlzLmJ1bmRsZUFzc2V0cyhmaWxlU2l6ZUxpbWl0LCBidWlsZERpcik7XG4gICAgdGhpcy5maWxlbmFtZXNBc3NldCA9IHRoaXMuYnVuZGxlRmlsZW5hbWVzQXNzZXQoYnVpbGREaXIpO1xuXG4gICAgLy8gQ3JlYXRlIEJ1Y2tldFxuICAgIHRoaXMuczNCdWNrZXQgPSB0aGlzLmNyZWF0ZVMzQnVja2V0KCk7XG5cbiAgICAvLyBDcmVhdGUgQ3VzdG9tIERvbWFpblxuICAgIHRoaXMuaG9zdGVkWm9uZSA9IHRoaXMubG9va3VwSG9zdGVkWm9uZSgpO1xuICAgIHRoaXMuYWNtQ2VydGlmaWNhdGUgPSB0aGlzLmNyZWF0ZUNlcnRpZmljYXRlKCk7XG5cbiAgICAvLyBDcmVhdGUgUzMgRGVwbG95bWVudFxuICAgIGNvbnN0IHMzZGVwbG95Q1IgPSB0aGlzLmNyZWF0ZVMzRGVwbG95bWVudCgpO1xuXG4gICAgLy8gQ3JlYXRlIENsb3VkRnJvbnRcbiAgICB0aGlzLmNmRGlzdHJpYnV0aW9uID0gdGhpcy5jcmVhdGVDZkRpc3RyaWJ1dGlvbigpO1xuICAgIHRoaXMuY2ZEaXN0cmlidXRpb24ubm9kZS5hZGREZXBlbmRlbmN5KHMzZGVwbG95Q1IpO1xuXG4gICAgLy8gSW52YWxpZGF0ZSBDbG91ZEZyb250XG4gICAgY29uc3QgaW52YWxpZGF0aW9uQ1IgPSB0aGlzLmNyZWF0ZUNsb3VkRnJvbnRJbnZhbGlkYXRpb24oKTtcbiAgICBpbnZhbGlkYXRpb25DUi5ub2RlLmFkZERlcGVuZGVuY3kodGhpcy5jZkRpc3RyaWJ1dGlvbik7XG5cbiAgICAvLyBDb25uZWN0IEN1c3RvbSBEb21haW4gdG8gQ2xvdWRGcm9udCBEaXN0cmlidXRpb25cbiAgICB0aGlzLmNyZWF0ZVJvdXRlNTNSZWNvcmRzKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHVybCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgaHR0cHM6Ly8ke3RoaXMuY2ZEaXN0cmlidXRpb24uZGlzdHJpYnV0aW9uRG9tYWluTmFtZX1gO1xuICB9XG5cbiAgcHVibGljIGdldCBjdXN0b21Eb21haW5VcmwoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCB7IGN1c3RvbURvbWFpbiB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoIWN1c3RvbURvbWFpbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgY3VzdG9tRG9tYWluID09PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gYGh0dHBzOi8vJHtjdXN0b21Eb21haW59YDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGBodHRwczovLyR7Y3VzdG9tRG9tYWluLmRvbWFpbk5hbWV9YDtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IGJ1Y2tldEFybigpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnMzQnVja2V0LmJ1Y2tldEFybjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYnVja2V0TmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnMzQnVja2V0LmJ1Y2tldE5hbWU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGRpc3RyaWJ1dGlvbklkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2ZEaXN0cmlidXRpb24uZGlzdHJpYnV0aW9uSWQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGRpc3RyaWJ1dGlvbkRvbWFpbigpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNmRGlzdHJpYnV0aW9uLmRpc3RyaWJ1dGlvbkRvbWFpbk5hbWU7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q29uc3RydWN0TWV0YWRhdGEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiU3RhdGljU2l0ZVwiIGFzIGNvbnN0LFxuICAgICAgZGF0YToge1xuICAgICAgICBkaXN0cmlidXRpb25JZDogdGhpcy5jZkRpc3RyaWJ1dGlvbi5kaXN0cmlidXRpb25JZCxcbiAgICAgICAgY3VzdG9tRG9tYWluVXJsOiB0aGlzLmN1c3RvbURvbWFpblVybCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRBcHAoKSB7XG4gICAgaWYgKHRoaXMuaXNQbGFjZWhvbGRlcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHsgcGF0aDogc2l0ZVBhdGgsIGJ1aWxkQ29tbWFuZCB9ID0gdGhpcy5wcm9wcztcblxuICAgIC8vIHZhbGlkYXRlIHNpdGUgcGF0aCBleGlzdHNcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoc2l0ZVBhdGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBObyBwYXRoIGZvdW5kIGF0IFwiJHtwYXRoLnJlc29sdmUoc2l0ZVBhdGgpfVwiIGZvciB0aGUgXCIke1xuICAgICAgICAgIHRoaXMubm9kZS5pZFxuICAgICAgICB9XCIgU3RhdGljU2l0ZS5gXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIGJ1aWxkXG4gICAgaWYgKGJ1aWxkQ29tbWFuZCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc29sZS5sb2coY2hhbGsuZ3JleShgQnVpbGRpbmcgc3RhdGljIHNpdGUgJHtzaXRlUGF0aH1gKSk7XG4gICAgICAgIGV4ZWNTeW5jKGJ1aWxkQ29tbWFuZCwge1xuICAgICAgICAgIGN3ZDogc2l0ZVBhdGgsXG4gICAgICAgICAgc3RkaW86IFwiaW5oZXJpdFwiLFxuICAgICAgICAgIGVudjoge1xuICAgICAgICAgICAgLi4ucHJvY2Vzcy5lbnYsXG4gICAgICAgICAgICAuLi5nZXRCdWlsZENtZEVudmlyb25tZW50KHRoaXMucHJvcHMuZW52aXJvbm1lbnQpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYFRoZXJlIHdhcyBhIHByb2JsZW0gYnVpbGRpbmcgdGhlIFwiJHt0aGlzLm5vZGUuaWR9XCIgU3RhdGljU2l0ZS5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidW5kbGVBc3NldHMoXG4gICAgZmlsZVNpemVMaW1pdDogbnVtYmVyLFxuICAgIGJ1aWxkRGlyOiBzdHJpbmdcbiAgKTogczNBc3NldHMuQXNzZXRbXSB7XG4gICAgaWYgKHRoaXMuaXNQbGFjZWhvbGRlcikge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgbmV3IHMzQXNzZXRzLkFzc2V0KHRoaXMsIFwiQXNzZXRcIiwge1xuICAgICAgICAgIHBhdGg6IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vYXNzZXRzL1N0YXRpY1NpdGUvc3R1YlwiKSxcbiAgICAgICAgfSksXG4gICAgICBdO1xuICAgIH1cblxuICAgIGNvbnN0IHsgcGF0aDogc2l0ZVBhdGgsIGJ1aWxkQ29tbWFuZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBidWlsZE91dHB1dCA9IHRoaXMucHJvcHMuYnVpbGRPdXRwdXQgfHwgXCIuXCI7XG5cbiAgICAvLyB2YWxpZGF0ZSBidWlsZE91dHB1dCBleGlzdHNcbiAgICBjb25zdCBzaXRlT3V0cHV0UGF0aCA9IHBhdGgucmVzb2x2ZShwYXRoLmpvaW4oc2l0ZVBhdGgsIGJ1aWxkT3V0cHV0KSk7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHNpdGVPdXRwdXRQYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgTm8gYnVpbGQgb3V0cHV0IGZvdW5kIGF0IFwiJHtzaXRlT3V0cHV0UGF0aH1cIiBmb3IgdGhlIFwiJHt0aGlzLm5vZGUuaWR9XCIgU3RhdGljU2l0ZS5gXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIGNyZWF0ZSB6aXAgZmlsZXNcbiAgICBjb25zdCBzY3JpcHQgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2Fzc2V0cy9CYXNlU2l0ZS9hcmNoaXZlci5qc1wiKTtcbiAgICBjb25zdCB6aXBQYXRoID0gcGF0aC5yZXNvbHZlKFxuICAgICAgcGF0aC5qb2luKGJ1aWxkRGlyLCBgU3RhdGljU2l0ZS0ke3RoaXMubm9kZS5pZH0tJHt0aGlzLm5vZGUuYWRkcn1gKVxuICAgICk7XG4gICAgLy8gY2xlYXIgemlwIHBhdGggdG8gZW5zdXJlIG5vIHBhcnRYLnppcCByZW1haW4gZnJvbSBwcmV2aW91cyBidWlsZFxuICAgIGZzLnJlbW92ZVN5bmMoemlwUGF0aCk7XG4gICAgY29uc3QgY21kID0gW1wibm9kZVwiLCBzY3JpcHQsIHNpdGVPdXRwdXRQYXRoLCB6aXBQYXRoLCBmaWxlU2l6ZUxpbWl0XS5qb2luKFxuICAgICAgXCIgXCJcbiAgICApO1xuXG4gICAgdHJ5IHtcbiAgICAgIGV4ZWNTeW5jKGNtZCwge1xuICAgICAgICBjd2Q6IHNpdGVQYXRoLFxuICAgICAgICBzdGRpbzogXCJpbmhlcml0XCIsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBUaGVyZSB3YXMgYSBwcm9ibGVtIGdlbmVyYXRpbmcgdGhlIFwiJHt0aGlzLm5vZGUuaWR9XCIgU3RhdGljU2l0ZSBwYWNrYWdlLmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gY3JlYXRlIGFzc2V0c1xuICAgIGNvbnN0IGFzc2V0cyA9IFtdO1xuICAgIGZvciAobGV0IHBhcnRJZCA9IDA7IDsgcGFydElkKyspIHtcbiAgICAgIGNvbnN0IHppcEZpbGVQYXRoID0gcGF0aC5qb2luKHppcFBhdGgsIGBwYXJ0JHtwYXJ0SWR9LnppcGApO1xuICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKHppcEZpbGVQYXRoKSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgYXNzZXRzLnB1c2goXG4gICAgICAgIG5ldyBzM0Fzc2V0cy5Bc3NldCh0aGlzLCBgQXNzZXQke3BhcnRJZH1gLCB7XG4gICAgICAgICAgcGF0aDogemlwRmlsZVBhdGgsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gYXNzZXRzO1xuICB9XG5cbiAgcHJpdmF0ZSBidW5kbGVGaWxlbmFtZXNBc3NldChidWlsZERpcjogc3RyaW5nKTogczNBc3NldHMuQXNzZXQgfCB1bmRlZmluZWQge1xuICAgIGlmICh0aGlzLmlzUGxhY2Vob2xkZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJvcHMucHVyZ2VGaWxlcyA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB6aXBQYXRoID0gcGF0aC5yZXNvbHZlKFxuICAgICAgcGF0aC5qb2luKGJ1aWxkRGlyLCBgU3RhdGljU2l0ZS0ke3RoaXMubm9kZS5pZH0tJHt0aGlzLm5vZGUuYWRkcn1gKVxuICAgICk7XG5cbiAgICAvLyBjcmVhdGUgYXNzZXRzXG4gICAgY29uc3QgZmlsZW5hbWVzUGF0aCA9IHBhdGguam9pbih6aXBQYXRoLCBgZmlsZW5hbWVzYCk7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGZpbGVuYW1lc1BhdGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBUaGVyZSB3YXMgYSBwcm9ibGVtIGdlbmVyYXRpbmcgdGhlIFwiJHt0aGlzLm5vZGUuaWR9XCIgU3RhdGljU2l0ZSBwYWNrYWdlLmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBzM0Fzc2V0cy5Bc3NldCh0aGlzLCBgQXNzZXRGaWxlbmFtZXNgLCB7XG4gICAgICBwYXRoOiBmaWxlbmFtZXNQYXRoLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTM0J1Y2tldCgpOiBzMy5CdWNrZXQge1xuICAgIGxldCB7IHMzQnVja2V0IH0gPSB0aGlzLnByb3BzO1xuICAgIHMzQnVja2V0ID0gczNCdWNrZXQgfHwge307XG5cbiAgICAvLyBWYWxpZGF0ZSBzM0J1Y2tldFxuICAgIGlmIChzM0J1Y2tldC53ZWJzaXRlSW5kZXhEb2N1bWVudCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRG8gbm90IGNvbmZpZ3VyZSB0aGUgXCJzM0J1Y2tldC53ZWJzaXRlSW5kZXhEb2N1bWVudFwiLiBVc2UgdGhlIFwiaW5kZXhQYWdlXCIgdG8gY29uZmlndXJlIHRoZSBTdGF0aWNTaXRlIGluZGV4IHBhZ2UuYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoczNCdWNrZXQud2Vic2l0ZUVycm9yRG9jdW1lbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYERvIG5vdCBjb25maWd1cmUgdGhlIFwiczNCdWNrZXQud2Vic2l0ZUVycm9yRG9jdW1lbnRcIi4gVXNlIHRoZSBcImVycm9yUGFnZVwiIHRvIGNvbmZpZ3VyZSB0aGUgU3RhdGljU2l0ZSBpbmRleCBwYWdlLmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBzMy5CdWNrZXQodGhpcywgXCJTM0J1Y2tldFwiLCB7XG4gICAgICBhdXRvRGVsZXRlT2JqZWN0czogdHJ1ZSxcbiAgICAgIHJlbW92YWxQb2xpY3k6IGNkay5SZW1vdmFsUG9saWN5LkRFU1RST1ksXG4gICAgICAuLi5zM0J1Y2tldCxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUzNEZXBsb3ltZW50KCk6IGNkay5DdXN0b21SZXNvdXJjZSB7XG4gICAgY29uc3QgeyBmaWxlT3B0aW9ucyB9ID0gdGhpcy5wcm9wcztcblxuICAgIC8vIENyZWF0ZSBhIExhbWJkYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgZG9pbmcgdGhlIHVwbG9hZGluZ1xuICAgIGNvbnN0IHVwbG9hZGVyID0gbmV3IGxhbWJkYS5GdW5jdGlvbih0aGlzLCBcIlMzVXBsb2FkZXJcIiwge1xuICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KFxuICAgICAgICBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2Fzc2V0cy9CYXNlU2l0ZS9jdXN0b20tcmVzb3VyY2VcIilcbiAgICAgICksXG4gICAgICBsYXllcnM6IFt0aGlzLmF3c0NsaUxheWVyXSxcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLlBZVEhPTl8zXzcsXG4gICAgICBoYW5kbGVyOiBcInMzLXVwbG9hZC5oYW5kbGVyXCIsXG4gICAgICB0aW1lb3V0OiBjZGsuRHVyYXRpb24ubWludXRlcygxNSksXG4gICAgICBtZW1vcnlTaXplOiAxMDI0LFxuICAgIH0pO1xuICAgIHRoaXMuczNCdWNrZXQuZ3JhbnRSZWFkV3JpdGUodXBsb2FkZXIpO1xuICAgIHRoaXMuYXNzZXRzLmZvckVhY2goKGFzc2V0KSA9PiBhc3NldC5ncmFudFJlYWQodXBsb2FkZXIpKTtcblxuICAgIC8vIENyZWF0ZSB0aGUgY3VzdG9tIHJlc291cmNlIGZ1bmN0aW9uXG4gICAgY29uc3QgaGFuZGxlciA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgXCJTM0hhbmRsZXJcIiwge1xuICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KFxuICAgICAgICBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2Fzc2V0cy9CYXNlU2l0ZS9jdXN0b20tcmVzb3VyY2VcIilcbiAgICAgICksXG4gICAgICBsYXllcnM6IFt0aGlzLmF3c0NsaUxheWVyXSxcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLlBZVEhPTl8zXzcsXG4gICAgICBoYW5kbGVyOiBcInMzLWhhbmRsZXIuaGFuZGxlclwiLFxuICAgICAgdGltZW91dDogY2RrLkR1cmF0aW9uLm1pbnV0ZXMoMTUpLFxuICAgICAgbWVtb3J5U2l6ZTogMTAyNCxcbiAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgIFVQTE9BREVSX0ZVTkNUSU9OX05BTUU6IHVwbG9hZGVyLmZ1bmN0aW9uTmFtZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy5zM0J1Y2tldC5ncmFudFJlYWRXcml0ZShoYW5kbGVyKTtcbiAgICB0aGlzLmZpbGVuYW1lc0Fzc2V0Py5ncmFudFJlYWQoaGFuZGxlcik7XG4gICAgdXBsb2FkZXIuZ3JhbnRJbnZva2UoaGFuZGxlcik7XG5cbiAgICAvLyBDcmVhdGUgY3VzdG9tIHJlc291cmNlXG4gICAgcmV0dXJuIG5ldyBjZGsuQ3VzdG9tUmVzb3VyY2UodGhpcywgXCJTM0RlcGxveW1lbnRcIiwge1xuICAgICAgc2VydmljZVRva2VuOiBoYW5kbGVyLmZ1bmN0aW9uQXJuLFxuICAgICAgcmVzb3VyY2VUeXBlOiBcIkN1c3RvbTo6U1NUQnVja2V0RGVwbG95bWVudFwiLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBTb3VyY2VzOiB0aGlzLmFzc2V0cy5tYXAoKGFzc2V0KSA9PiAoe1xuICAgICAgICAgIEJ1Y2tldE5hbWU6IGFzc2V0LnMzQnVja2V0TmFtZSxcbiAgICAgICAgICBPYmplY3RLZXk6IGFzc2V0LnMzT2JqZWN0S2V5LFxuICAgICAgICB9KSksXG4gICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogdGhpcy5zM0J1Y2tldC5idWNrZXROYW1lLFxuICAgICAgICBGaWxlbmFtZXM6IHRoaXMuZmlsZW5hbWVzQXNzZXQgJiYge1xuICAgICAgICAgIEJ1Y2tldE5hbWU6IHRoaXMuZmlsZW5hbWVzQXNzZXQuczNCdWNrZXROYW1lLFxuICAgICAgICAgIE9iamVjdEtleTogdGhpcy5maWxlbmFtZXNBc3NldC5zM09iamVjdEtleSxcbiAgICAgICAgfSxcbiAgICAgICAgRmlsZU9wdGlvbnM6IChmaWxlT3B0aW9ucyB8fCBbXSkubWFwKFxuICAgICAgICAgICh7IGV4Y2x1ZGUsIGluY2x1ZGUsIGNhY2hlQ29udHJvbCB9KSA9PiB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGV4Y2x1ZGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgZXhjbHVkZSA9IFtleGNsdWRlXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgaW5jbHVkZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICBpbmNsdWRlID0gW2luY2x1ZGVdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IFtdO1xuICAgICAgICAgICAgZXhjbHVkZS5mb3JFYWNoKChwZXIpID0+IG9wdGlvbnMucHVzaChcIi0tZXhjbHVkZVwiLCBwZXIpKTtcbiAgICAgICAgICAgIGluY2x1ZGUuZm9yRWFjaCgocGVyKSA9PiBvcHRpb25zLnB1c2goXCItLWluY2x1ZGVcIiwgcGVyKSk7XG4gICAgICAgICAgICBvcHRpb25zLnB1c2goXCItLWNhY2hlLWNvbnRyb2xcIiwgY2FjaGVDb250cm9sKTtcbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zO1xuICAgICAgICAgIH1cbiAgICAgICAgKSxcbiAgICAgICAgUmVwbGFjZVZhbHVlczogdGhpcy5nZXRTM0NvbnRlbnRSZXBsYWNlVmFsdWVzKCksXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIC8vIENsb3VkRnJvbnQgRGlzdHJpYnV0aW9uXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIHByaXZhdGUgY3JlYXRlQ2ZEaXN0cmlidXRpb24oKTogY2xvdWRmcm9udC5EaXN0cmlidXRpb24ge1xuICAgIGNvbnN0IHsgY2ZEaXN0cmlidXRpb24sIGN1c3RvbURvbWFpbiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBpbmRleFBhZ2UgPSB0aGlzLnByb3BzLmluZGV4UGFnZSB8fCBcImluZGV4Lmh0bWxcIjtcbiAgICBjb25zdCBlcnJvclBhZ2UgPSB0aGlzLnByb3BzLmVycm9yUGFnZTtcblxuICAgIGNvbnN0IGNmRGlzdHJpYnV0aW9uUHJvcHMgPSBjZkRpc3RyaWJ1dGlvbiB8fCB7fTtcblxuICAgIC8vIFZhbGlkYXRlIGlucHV0XG4gICAgaWYgKGNmRGlzdHJpYnV0aW9uUHJvcHMuY2VydGlmaWNhdGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYERvIG5vdCBjb25maWd1cmUgdGhlIFwiY2ZEaXN0cmlidXRpb24uY2VydGlmaWNhdGVcIi4gVXNlIHRoZSBcImN1c3RvbURvbWFpblwiIHRvIGNvbmZpZ3VyZSB0aGUgU3RhdGljU2l0ZSBkb21haW4gY2VydGlmaWNhdGUuYFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGNmRGlzdHJpYnV0aW9uUHJvcHMuZG9tYWluTmFtZXMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYERvIG5vdCBjb25maWd1cmUgdGhlIFwiY2ZEaXN0cmlidXRpb24uZG9tYWluTmFtZXNcIi4gVXNlIHRoZSBcImN1c3RvbURvbWFpblwiIHRvIGNvbmZpZ3VyZSB0aGUgU3RhdGljU2l0ZSBkb21haW4uYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBCdWlsZCBkb21haW5OYW1lc1xuICAgIGNvbnN0IGRvbWFpbk5hbWVzID0gW107XG4gICAgaWYgKCFjdXN0b21Eb21haW4pIHtcbiAgICAgIC8vIG5vIGRvbWFpblxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGN1c3RvbURvbWFpbiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgZG9tYWluTmFtZXMucHVzaChjdXN0b21Eb21haW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb21haW5OYW1lcy5wdXNoKGN1c3RvbURvbWFpbi5kb21haW5OYW1lKTtcbiAgICAgIGlmIChjdXN0b21Eb21haW4uYWx0ZXJuYXRlTmFtZXMpIHtcbiAgICAgICAgaWYgKCFjdXN0b21Eb21haW4uY2VydGlmaWNhdGUpXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJDZXJ0aWZpY2F0ZXMgZm9yIGFsdGVybmF0ZSBkb21haW5zIGNhbm5vdCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQuIFBsZWFzZSBzcGVjaWZ5IGNlcnRpZmljYXRlIHRvIHVzZVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgZG9tYWluTmFtZXMucHVzaCguLi5jdXN0b21Eb21haW4uYWx0ZXJuYXRlTmFtZXMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEJ1aWxkIGVycm9yUmVzcG9uc2VzXG4gICAgbGV0IGVycm9yUmVzcG9uc2VzO1xuICAgIC8vIGNhc2U6IHNzdCBzdGFydCA9PiBzaG93aW5nIHN0dWIgc2l0ZSwgYW5kIHJlZGlyZWN0IGFsbCByb3V0ZXMgdG8gdGhlIGluZGV4IHBhZ2VcbiAgICBpZiAodGhpcy5pc1BsYWNlaG9sZGVyKSB7XG4gICAgICBlcnJvclJlc3BvbnNlcyA9IGJ1aWxkRXJyb3JSZXNwb25zZXNGb3JSZWRpcmVjdFRvSW5kZXgoaW5kZXhQYWdlKTtcbiAgICB9IGVsc2UgaWYgKGVycm9yUGFnZSkge1xuICAgICAgaWYgKGNmRGlzdHJpYnV0aW9uUHJvcHMuZXJyb3JSZXNwb25zZXMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDYW5ub3QgY29uZmlndXJlIHRoZSBcImNmRGlzdHJpYnV0aW9uLmVycm9yUmVzcG9uc2VzXCIgd2hlbiBcImVycm9yUGFnZVwiIGlzIHBhc3NlZCBpbi4gVXNlIG9uZSBvciB0aGUgb3RoZXIgdG8gY29uZmlndXJlIHRoZSBiZWhhdmlvciBmb3IgZXJyb3IgcGFnZXMuYFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBlcnJvclJlc3BvbnNlcyA9XG4gICAgICAgIGVycm9yUGFnZSA9PT0gU3RhdGljU2l0ZUVycm9yT3B0aW9ucy5SRURJUkVDVF9UT19JTkRFWF9QQUdFXG4gICAgICAgICAgPyBidWlsZEVycm9yUmVzcG9uc2VzRm9yUmVkaXJlY3RUb0luZGV4KGluZGV4UGFnZSlcbiAgICAgICAgICA6IGJ1aWxkRXJyb3JSZXNwb25zZXNGb3I0MDRFcnJvclBhZ2UoZXJyb3JQYWdlKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgQ2xvdWRGcm9udCBkaXN0cmlidXRpb25cbiAgICByZXR1cm4gbmV3IGNsb3VkZnJvbnQuRGlzdHJpYnV0aW9uKHRoaXMsIFwiRGlzdHJpYnV0aW9uXCIsIHtcbiAgICAgIC8vIHRoZXNlIHZhbHVlcyBjYW4gYmUgb3ZlcndyaXR0ZW4gYnkgY2ZEaXN0cmlidXRpb25Qcm9wc1xuICAgICAgZGVmYXVsdFJvb3RPYmplY3Q6IGluZGV4UGFnZSxcbiAgICAgIGVycm9yUmVzcG9uc2VzLFxuICAgICAgLi4uY2ZEaXN0cmlidXRpb25Qcm9wcyxcbiAgICAgIC8vIHRoZXNlIHZhbHVlcyBjYW4gTk9UIGJlIG92ZXJ3cml0dGVuIGJ5IGNmRGlzdHJpYnV0aW9uUHJvcHNcbiAgICAgIGRvbWFpbk5hbWVzLFxuICAgICAgY2VydGlmaWNhdGU6IHRoaXMuYWNtQ2VydGlmaWNhdGUsXG4gICAgICBkZWZhdWx0QmVoYXZpb3I6IHtcbiAgICAgICAgb3JpZ2luOiBuZXcgY2ZPcmlnaW5zLlMzT3JpZ2luKHRoaXMuczNCdWNrZXQpLFxuICAgICAgICB2aWV3ZXJQcm90b2NvbFBvbGljeTogY2xvdWRmcm9udC5WaWV3ZXJQcm90b2NvbFBvbGljeS5SRURJUkVDVF9UT19IVFRQUyxcbiAgICAgICAgLi4uKGNmRGlzdHJpYnV0aW9uUHJvcHMuZGVmYXVsdEJlaGF2aW9yIHx8IHt9KSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNsb3VkRnJvbnRJbnZhbGlkYXRpb24oKTogY2RrLkN1c3RvbVJlc291cmNlIHtcbiAgICAvLyBDcmVhdGUgYSBMYW1iZGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGRvaW5nIHRoZSBpbnZhbGlkYXRpb25cbiAgICBjb25zdCBpbnZhbGlkYXRvciA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgXCJDbG91ZEZyb250SW52YWxpZGF0b3JcIiwge1xuICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KFxuICAgICAgICBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2Fzc2V0cy9CYXNlU2l0ZS9jdXN0b20tcmVzb3VyY2VcIilcbiAgICAgICksXG4gICAgICBsYXllcnM6IFt0aGlzLmF3c0NsaUxheWVyXSxcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLlBZVEhPTl8zXzcsXG4gICAgICBoYW5kbGVyOiBcImNmLWludmFsaWRhdGUuaGFuZGxlclwiLFxuICAgICAgdGltZW91dDogY2RrLkR1cmF0aW9uLm1pbnV0ZXMoMTUpLFxuICAgICAgbWVtb3J5U2l6ZTogMTAyNCxcbiAgICB9KTtcblxuICAgIC8vIEdyYW50IHBlcm1pc3Npb25zIHRvIGludmFsaWRhdGUgQ0YgRGlzdHJpYnV0aW9uXG4gICAgaW52YWxpZGF0b3IuYWRkVG9Sb2xlUG9saWN5KFxuICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICBcImNsb3VkZnJvbnQ6R2V0SW52YWxpZGF0aW9uXCIsXG4gICAgICAgICAgXCJjbG91ZGZyb250OkNyZWF0ZUludmFsaWRhdGlvblwiLFxuICAgICAgICBdLFxuICAgICAgICByZXNvdXJjZXM6IFtcIipcIl0sXG4gICAgICB9KVxuICAgICk7XG5cbiAgICAvLyBOZWVkIHRoZSBBc3NldEhhc2ggZmllbGQgc28gdGhlIENSIGdldHMgdXBkYXRlZCBvbiBlYWNoIGRlcGxveVxuICAgIGNvbnN0IGFzc2V0c0hhc2ggPSBjcnlwdG9cbiAgICAgIC5jcmVhdGVIYXNoKFwibWQ1XCIpXG4gICAgICAudXBkYXRlKHRoaXMuYXNzZXRzLm1hcCgoeyBhc3NldEhhc2ggfSkgPT4gYXNzZXRIYXNoKS5qb2luKFwiXCIpKVxuICAgICAgLmRpZ2VzdChcImhleFwiKTtcblxuICAgIC8vIENyZWF0ZSBjdXN0b20gcmVzb3VyY2VcbiAgICBjb25zdCB3YWl0Rm9ySW52YWxpZGF0aW9uID1cbiAgICAgIHRoaXMucHJvcHMud2FpdEZvckludmFsaWRhdGlvbiA9PT0gZmFsc2UgPyBmYWxzZSA6IHRydWU7XG4gICAgcmV0dXJuIG5ldyBjZGsuQ3VzdG9tUmVzb3VyY2UodGhpcywgXCJDbG91ZEZyb250SW52YWxpZGF0aW9uXCIsIHtcbiAgICAgIHNlcnZpY2VUb2tlbjogaW52YWxpZGF0b3IuZnVuY3Rpb25Bcm4sXG4gICAgICByZXNvdXJjZVR5cGU6IFwiQ3VzdG9tOjpTU1RDbG91ZEZyb250SW52YWxpZGF0aW9uXCIsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIEFzc2V0c0hhc2g6IGFzc2V0c0hhc2gsXG4gICAgICAgIERpc3RyaWJ1dGlvbklkOiB0aGlzLmNmRGlzdHJpYnV0aW9uLmRpc3RyaWJ1dGlvbklkLFxuICAgICAgICBEaXN0cmlidXRpb25QYXRoczogW1wiLypcIl0sXG4gICAgICAgIFdhaXRGb3JJbnZhbGlkYXRpb246IHdhaXRGb3JJbnZhbGlkYXRpb24sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIC8vIEN1c3RvbSBEb21haW5cbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgcHJvdGVjdGVkIHZhbGlkYXRlQ3VzdG9tRG9tYWluU2V0dGluZ3MoKSB7XG4gICAgY29uc3QgeyBjdXN0b21Eb21haW4gfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoIWN1c3RvbURvbWFpbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgY3VzdG9tRG9tYWluID09PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGN1c3RvbURvbWFpbi5pc0V4dGVybmFsRG9tYWluID09PSB0cnVlKSB7XG4gICAgICBpZiAoIWN1c3RvbURvbWFpbi5jZXJ0aWZpY2F0ZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYEEgdmFsaWQgY2VydGlmaWNhdGUgaXMgcmVxdWlyZWQgd2hlbiBcImlzRXh0ZXJuYWxEb21haW5cIiBpcyBzZXQgdG8gXCJ0cnVlXCIuYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKGN1c3RvbURvbWFpbi5kb21haW5BbGlhcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYERvbWFpbiBhbGlhcyBpcyBvbmx5IHN1cHBvcnRlZCBmb3IgZG9tYWlucyBob3N0ZWQgb24gQW1hem9uIFJvdXRlIDUzLiBEbyBub3Qgc2V0IHRoZSBcImN1c3RvbURvbWFpbi5kb21haW5BbGlhc1wiIHdoZW4gXCJpc0V4dGVybmFsRG9tYWluXCIgaXMgZW5hYmxlZC5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoY3VzdG9tRG9tYWluLmhvc3RlZFpvbmUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBIb3N0ZWQgem9uZXMgY2FuIG9ubHkgYmUgY29uZmlndXJlZCBmb3IgZG9tYWlucyBob3N0ZWQgb24gQW1hem9uIFJvdXRlIDUzLiBEbyBub3Qgc2V0IHRoZSBcImN1c3RvbURvbWFpbi5ob3N0ZWRab25lXCIgd2hlbiBcImlzRXh0ZXJuYWxEb21haW5cIiBpcyBlbmFibGVkLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgbG9va3VwSG9zdGVkWm9uZSgpOiByb3V0ZTUzLklIb3N0ZWRab25lIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCB7IGN1c3RvbURvbWFpbiB9ID0gdGhpcy5wcm9wcztcblxuICAgIC8vIFNraXAgaWYgY3VzdG9tRG9tYWluIGlzIG5vdCBjb25maWd1cmVkXG4gICAgaWYgKCFjdXN0b21Eb21haW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgaG9zdGVkWm9uZTtcblxuICAgIGlmICh0eXBlb2YgY3VzdG9tRG9tYWluID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBob3N0ZWRab25lID0gcm91dGU1My5Ib3N0ZWRab25lLmZyb21Mb29rdXAodGhpcywgXCJIb3N0ZWRab25lXCIsIHtcbiAgICAgICAgZG9tYWluTmFtZTogY3VzdG9tRG9tYWluLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChpc0NES0NvbnN0cnVjdChjdXN0b21Eb21haW4uaG9zdGVkWm9uZSkpIHtcbiAgICAgIGhvc3RlZFpvbmUgPSBjdXN0b21Eb21haW4uaG9zdGVkWm9uZSBhcyByb3V0ZTUzLklIb3N0ZWRab25lO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGN1c3RvbURvbWFpbi5ob3N0ZWRab25lID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBob3N0ZWRab25lID0gcm91dGU1My5Ib3N0ZWRab25lLmZyb21Mb29rdXAodGhpcywgXCJIb3N0ZWRab25lXCIsIHtcbiAgICAgICAgZG9tYWluTmFtZTogY3VzdG9tRG9tYWluLmhvc3RlZFpvbmUsXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjdXN0b21Eb21haW4uZG9tYWluTmFtZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgLy8gU2tpcCBpZiBkb21haW4gaXMgbm90IGEgUm91dGU1MyBkb21haW5cbiAgICAgIGlmIChjdXN0b21Eb21haW4uaXNFeHRlcm5hbERvbWFpbiA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGhvc3RlZFpvbmUgPSByb3V0ZTUzLkhvc3RlZFpvbmUuZnJvbUxvb2t1cCh0aGlzLCBcIkhvc3RlZFpvbmVcIiwge1xuICAgICAgICBkb21haW5OYW1lOiBjdXN0b21Eb21haW4uZG9tYWluTmFtZSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBob3N0ZWRab25lID0gY3VzdG9tRG9tYWluLmhvc3RlZFpvbmU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGhvc3RlZFpvbmU7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNlcnRpZmljYXRlKCk6IGFjbS5JQ2VydGlmaWNhdGUgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IHsgY3VzdG9tRG9tYWluIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKCFjdXN0b21Eb21haW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgYWNtQ2VydGlmaWNhdGU7XG5cbiAgICAvLyBIb3N0ZWRab25lIGlzIHNldCBmb3IgUm91dGUgNTMgZG9tYWluc1xuICAgIGlmICh0aGlzLmhvc3RlZFpvbmUpIHtcbiAgICAgIGlmICh0eXBlb2YgY3VzdG9tRG9tYWluID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGFjbUNlcnRpZmljYXRlID0gbmV3IGFjbS5EbnNWYWxpZGF0ZWRDZXJ0aWZpY2F0ZSh0aGlzLCBcIkNlcnRpZmljYXRlXCIsIHtcbiAgICAgICAgICBkb21haW5OYW1lOiBjdXN0b21Eb21haW4sXG4gICAgICAgICAgaG9zdGVkWm9uZTogdGhpcy5ob3N0ZWRab25lLFxuICAgICAgICAgIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIixcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKGN1c3RvbURvbWFpbi5jZXJ0aWZpY2F0ZSkge1xuICAgICAgICBhY21DZXJ0aWZpY2F0ZSA9IGN1c3RvbURvbWFpbi5jZXJ0aWZpY2F0ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjbUNlcnRpZmljYXRlID0gbmV3IGFjbS5EbnNWYWxpZGF0ZWRDZXJ0aWZpY2F0ZSh0aGlzLCBcIkNlcnRpZmljYXRlXCIsIHtcbiAgICAgICAgICBkb21haW5OYW1lOiBjdXN0b21Eb21haW4uZG9tYWluTmFtZSxcbiAgICAgICAgICBob3N0ZWRab25lOiB0aGlzLmhvc3RlZFpvbmUsXG4gICAgICAgICAgcmVnaW9uOiBcInVzLWVhc3QtMVwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gSG9zdGVkWm9uZSBpcyBOT1Qgc2V0IGZvciBub24tUm91dGUgNTMgZG9tYWluc1xuICAgIGVsc2Uge1xuICAgICAgaWYgKHR5cGVvZiBjdXN0b21Eb21haW4gIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgYWNtQ2VydGlmaWNhdGUgPSBjdXN0b21Eb21haW4uY2VydGlmaWNhdGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjbUNlcnRpZmljYXRlO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZVJvdXRlNTNSZWNvcmRzKCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY3VzdG9tRG9tYWluIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKCFjdXN0b21Eb21haW4gfHwgIXRoaXMuaG9zdGVkWm9uZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCByZWNvcmROYW1lO1xuICAgIGxldCBkb21haW5BbGlhcztcbiAgICBpZiAodHlwZW9mIGN1c3RvbURvbWFpbiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmVjb3JkTmFtZSA9IGN1c3RvbURvbWFpbjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVjb3JkTmFtZSA9IGN1c3RvbURvbWFpbi5kb21haW5OYW1lO1xuICAgICAgZG9tYWluQWxpYXMgPSBjdXN0b21Eb21haW4uZG9tYWluQWxpYXM7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIEROUyByZWNvcmRcbiAgICBjb25zdCByZWNvcmRQcm9wcyA9IHtcbiAgICAgIHJlY29yZE5hbWUsXG4gICAgICB6b25lOiB0aGlzLmhvc3RlZFpvbmUsXG4gICAgICB0YXJnZXQ6IHJvdXRlNTMuUmVjb3JkVGFyZ2V0LmZyb21BbGlhcyhcbiAgICAgICAgbmV3IHJvdXRlNTNUYXJnZXRzLkNsb3VkRnJvbnRUYXJnZXQodGhpcy5jZkRpc3RyaWJ1dGlvbilcbiAgICAgICksXG4gICAgfTtcbiAgICBuZXcgcm91dGU1My5BUmVjb3JkKHRoaXMsIFwiQWxpYXNSZWNvcmRcIiwgcmVjb3JkUHJvcHMpO1xuICAgIG5ldyByb3V0ZTUzLkFhYWFSZWNvcmQodGhpcywgXCJBbGlhc1JlY29yZEFBQUFcIiwgcmVjb3JkUHJvcHMpO1xuXG4gICAgLy8gQ3JlYXRlIEFsaWFzIHJlZGlyZWN0IHJlY29yZFxuICAgIGlmIChkb21haW5BbGlhcykge1xuICAgICAgbmV3IHJvdXRlNTNQYXR0ZXJucy5IdHRwc1JlZGlyZWN0KHRoaXMsIFwiUmVkaXJlY3RcIiwge1xuICAgICAgICB6b25lOiB0aGlzLmhvc3RlZFpvbmUsXG4gICAgICAgIHJlY29yZE5hbWVzOiBbZG9tYWluQWxpYXNdLFxuICAgICAgICB0YXJnZXREb21haW46IHJlY29yZE5hbWUsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgLy8gSGVscGVyIEZ1bmN0aW9uc1xuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBwcml2YXRlIGdldFMzQ29udGVudFJlcGxhY2VWYWx1ZXMoKTogQmFzZVNpdGVSZXBsYWNlUHJvcHNbXSB7XG4gICAgY29uc3QgcmVwbGFjZVZhbHVlczogQmFzZVNpdGVSZXBsYWNlUHJvcHNbXSA9XG4gICAgICB0aGlzLnByb3BzLnJlcGxhY2VWYWx1ZXMgfHwgW107XG5cbiAgICBPYmplY3QuZW50cmllcyh0aGlzLnByb3BzLmVudmlyb25tZW50IHx8IHt9KVxuICAgICAgLmZpbHRlcigoWywgdmFsdWVdKSA9PiBjZGsuVG9rZW4uaXNVbnJlc29sdmVkKHZhbHVlKSlcbiAgICAgIC5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBge3sgJHtrZXl9IH19YDtcbiAgICAgICAgcmVwbGFjZVZhbHVlcy5wdXNoKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpbGVzOiBcIioqLyouaHRtbFwiLFxuICAgICAgICAgICAgc2VhcmNoOiB0b2tlbixcbiAgICAgICAgICAgIHJlcGxhY2U6IHZhbHVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmlsZXM6IFwiKiovKi5qc1wiLFxuICAgICAgICAgICAgc2VhcmNoOiB0b2tlbixcbiAgICAgICAgICAgIHJlcGxhY2U6IHZhbHVlLFxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIHJldHVybiByZXBsYWNlVmFsdWVzO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlclNpdGVFbnZpcm9ubWVudCgpIHtcbiAgICBjb25zdCBlbnZpcm9ubWVudE91dHB1dHM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh0aGlzLnByb3BzLmVudmlyb25tZW50IHx8IHt9KSkge1xuICAgICAgY29uc3Qgb3V0cHV0SWQgPSBgU3N0U2l0ZUVudl8ke2tleX1gO1xuICAgICAgY29uc3Qgb3V0cHV0ID0gbmV3IGNkay5DZm5PdXRwdXQodGhpcywgb3V0cHV0SWQsIHsgdmFsdWUgfSk7XG4gICAgICBlbnZpcm9ubWVudE91dHB1dHNba2V5XSA9IGNkay5TdGFjay5vZih0aGlzKS5nZXRMb2dpY2FsSWQob3V0cHV0KTtcbiAgICB9XG5cbiAgICBjb25zdCByb290ID0gdGhpcy5ub2RlLnJvb3QgYXMgQXBwO1xuICAgIHJvb3QucmVnaXN0ZXJTaXRlRW52aXJvbm1lbnQoe1xuICAgICAgaWQ6IHRoaXMubm9kZS5pZCxcbiAgICAgIHBhdGg6IHRoaXMucHJvcHMucGF0aCxcbiAgICAgIHN0YWNrOiBjZGsuU3RhY2sub2YodGhpcykubm9kZS5pZCxcbiAgICAgIGVudmlyb25tZW50T3V0cHV0cyxcbiAgICB9IGFzIEJhc2VTaXRlRW52aXJvbm1lbnRPdXRwdXRzSW5mbyk7XG4gIH1cbn1cbiJdfQ==